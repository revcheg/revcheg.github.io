const BODY=document.querySelector(".body"),HEADER=document.querySelector(".header"),FOOTER=document.querySelector(".footer"),MAIN=document.querySelector(".main"),VIDEO=document.querySelector(".video"),WRAPPER=document.querySelector(".video__wrapper"),SETTINGS=document.querySelector(".settings"),STATISTICS=document.querySelector(".statistics"),SERIESLIST=document.querySelector(".series"),VIDEORANGE=document.querySelector(".control__range--duration"),STARTBUTTON=document.querySelector(".video__start"),CONTROLS=document.querySelector(".control"),ERROR=document.querySelector(".error"),consoleContainer=document.querySelector(".console"),consoleInput=consoleContainer.querySelector(".console__input"),consoleBackground=consoleContainer.querySelector(".console__background");let consoleFlag=!1;function openConsole(){consoleFlag=!consoleFlag,consoleFlag?(consoleContainer.classList.remove("console--hide"),VIDEO.blur(),consoleInput.value="",consoleInput.focus(),consoleBackground.play()):(consoleContainer.classList.add("console--hide"),VIDEO.focus(),consoleInput.blur())}function stopPropagation(e){e.stopPropagation()}function checkBonus(e){if("Enter"===e.key){switch(consoleInput.value){case"unlimited spider man":VIDEO.src="video/USP-intro.mp4",openConsole(),showError("Відкрито бонусне відео &#128375;");break;case"spider man":VIDEO.src="video/SP-intro.mp4",openConsole(),showError("Відкрито бонусне відео &#128375;");break;default:showError("Команда неможлива &#128126;")}autoplayFlag?VIDEO.addEventListener("loadeddata",startVideo):VIDEO.removeEventListener("loadeddata",startVideo),consoleInput.value=""}}consoleInput.addEventListener("input",stopPropagation),consoleInput.addEventListener("keyup",stopPropagation),consoleInput.addEventListener("keyup",checkBonus),VIDEO.controls=!1;const playButton=CONTROLS.querySelector(".control__button--play"),playButtonIcon=CONTROLS.querySelector(".control__icon--play"),pauseButtonIcon=CONTROLS.querySelector(".control__icon--pause");function pauseVideo(){VIDEO.paused?VIDEO.play():VIDEO.pause()}function changePauseIcon(){playButtonIcon.classList.toggle("control__icon--hide"),pauseButtonIcon.classList.toggle("control__icon--hide")}playButton.addEventListener("click",pauseVideo),playButton.addEventListener("click",changePauseIcon),VIDEO.addEventListener("click",pauseVideo),VIDEO.addEventListener("click",changePauseIcon);const muteButton=CONTROLS.querySelector(".control__button--mute"),muteButtonIcon=CONTROLS.querySelector(".control__muted");function muteVideo(){let e=VIDEO.volume;VIDEO.muted?(VIDEO.muted=!1,VIDEO.volume=e,volumeRange.value=VIDEO.volume,e<=0&&(VIDEO.volume=.5,volumeRange.value=.5)):(VIDEO.muted=!0,volumeRange.value=0)}function changeMuteIcon(){VIDEO.muted?(muteButtonIcon.classList.remove("control__muted--hide"),muteButton.classList.add("control__button--active")):(muteButtonIcon.classList.add("control__muted--hide"),muteButton.classList.remove("control__button--active"))}muteButton.addEventListener("click",muteVideo),muteButton.addEventListener("click",changeMuteIcon),VIDEO.volume=.5;const volumeRange=CONTROLS.querySelector(".control__range--volume");function changeVolume(e){let t=VIDEO.volume+e;t=Math.max(0,Math.min(1,t)),VIDEO.volume=t,volumeRange.value=t,updateVolume()}function updateVolume(){VIDEO.volume=volumeRange.value,0===VIDEO.volume?(VIDEO.muted=!0,changeMuteIcon()):(VIDEO.muted=!1,changeMuteIcon())}function wheelVolume(e){e.preventDefault();changeVolume(.1*-Math.sign(e.deltaY))}volumeRange.addEventListener("input",updateVolume),volumeRange.addEventListener("wheel",wheelVolume);const videoPassed=CONTROLS.querySelector(".control__time--passed"),videoLeft=CONTROLS.querySelector(".control__time--left");let rangeValue;function changeDuration(){VIDEO.currentTime=VIDEORANGE.value,VIDEO.play(),pauseButtonIcon.classList.contains("control__icon--hide")&&changePauseIcon()}function setDuration(){rangeValue=VIDEORANGE.value,line.value=rangeValue,line.style.width=Math.round(rangeValue/videoDuration*100)+"%",currentVideoPassed=formatTime(rangeValue),currentVideoLeft=formatTime(videoDuration-rangeValue),videoPassed.innerHTML=currentVideoPassed,videoLeft.innerHTML=currentVideoLeft}function resetDuration(){VIDEORANGE.value="0",videoPassed.innerHTML=formatTime(0),videoLeft.innerHTML=formatTime(0),line.style.width="0%",line.value=0}function formatTime(e){let t=Math.floor(e/3600),o=Math.floor((e-3600*t)/60),n=Math.floor(e-3600*t-60*o);return t=t<10?"0"+t:t,o=o<10?"0"+o:o,n=n<10?"0"+n:n,t+":"+o+":"+n}function wheelDuration(e){e.preventDefault();const t=-Math.sign(e.deltaY);let o=parseFloat(VIDEORANGE.value)+t;VIDEORANGE.value=o,changeDuration()}VIDEORANGE.addEventListener("mousedown",(function(){VIDEO.pause(),playButtonIcon.classList.contains("control__icon--hide")&&changePauseIcon()})),VIDEORANGE.addEventListener("change",changeDuration),VIDEORANGE.addEventListener("input",setDuration),VIDEORANGE.addEventListener("wheel",wheelDuration);let playbackRate=1;const speedButton=CONTROLS.querySelector(".control__button--speed"),speedInfo=speedButton.querySelector(".control__info");function changeSpeed(){playbackRate+=.25,playbackRate>2&&(playbackRate=1),VIDEO.playbackRate=playbackRate,speedInfo.classList.remove("control__info--hide"),speedInfo.innerHTML=playbackRate,1!==playbackRate?speedButton.classList.add("control__button--active"):(speedButton.classList.remove("control__button--active"),speedInfo.classList.add("control__info--hide"))}speedButton.addEventListener("click",changeSpeed);const pipButton=CONTROLS.querySelector(".control__button--pip");function openPip(){document.pictureInPictureElement?(VIDEO.setAttribute("disablePictureInPicture","disablePictureInPicture"),document.exitPictureInPicture().then((()=>{pipButton.classList.remove("control__button--active"),pipButton.setAttribute("aria-label","Міні-програвач"),pipButton.setAttribute("title","Міні-програвач (q)")})).catch((e=>{console.error(e)}))):(VIDEO.removeAttribute("disablePictureInPicture"),VIDEO.requestPictureInPicture().then((()=>{pipButton.classList.add("control__button--active"),pipButton.setAttribute("aria-label","Закрити міні-програвач"),pipButton.setAttribute("title","Закрити міні-програвач (q)")})).catch((e=>{console.error(e)})))}function closePip(){pipButton.classList.remove("control__button--active"),VIDEO.setAttribute("disablePictureInPicture","disablePictureInPicture"),VIDEO.paused?(playButtonIcon.classList.remove("control__icon--hide"),pauseButtonIcon.classList.add("control__icon--hide")):(playButtonIcon.classList.add("control__icon--hide"),pauseButtonIcon.classList.remove("control__icon--hide"))}pipButton.addEventListener("click",openPip),document.addEventListener("leavepictureinpicture",closePip);const fitButton=CONTROLS.querySelector(".control__button--fit");function changeFitscreen(){let e="cover"===VIDEO.style.objectFit?"contain":"cover";VIDEO.style.objectFit=e,"contain"===e?(fitButton.setAttribute("aria-label","Ростягнути зображення"),fitButton.setAttribute("title","Ростягнути зображення (x)"),fitButton.classList.remove("control__button--active")):(fitButton.setAttribute("aria-label","Зменшити зображення"),fitButton.setAttribute("title","Зменшити зображення (x)"),fitButton.classList.add("control__button--active"))}function checkFitscreen(){videoWidth===WRAPPER.clientWidth?fitButton.classList.add("control__button--hide"):fitButton.classList.remove("control__button--hide")}fitButton.addEventListener("click",changeFitscreen),window.addEventListener("fullscreenchange",checkFitscreen);const cinemaButton=CONTROLS.querySelector(".control__button--cinema");let cinemaFlag=!1;function setCinema(){cinemaFlag=!cinemaFlag,cinemaFlag?(cinemaButton.classList.add("control__button--active"),cinemaButton.setAttribute("aria-label","Вийти з режиму кінотеатра"),cinemaButton.setAttribute("title","Вийти з режиму кінотеатра (t)"),HEADER.classList.add("header--hide"),FOOTER.classList.add("footer--hide"),SERIESLIST.classList.add("series--off"),BODY.style.overflow="hidden",setTimeout((()=>{HEADER.style.display="none",FOOTER.style.display="none",WRAPPER.classList.add("video__wrapper--cinema"),MAIN.classList.add("main--cinema"),VIDEO.focus()}),250)):(cinemaButton.classList.remove("control__button--active"),cinemaButton.setAttribute("aria-label","Режим кінотеатру"),cinemaButton.setAttribute("title","Режим кінотеатру (t)"),HEADER.style.display="flex",FOOTER.style.display="flex",seriesCheckbox.checked&&SERIESLIST.classList.remove("series--off"),setTimeout((()=>{HEADER.classList.remove("header--hide"),FOOTER.classList.remove("footer--hide")}),150),BODY.removeAttribute("style"),WRAPPER.classList.remove("video__wrapper--cinema"),MAIN.classList.remove("main--cinema"),VIDEO.blur())}cinemaButton.addEventListener("click",setCinema);const fullButton=CONTROLS.querySelector(".control__button--size"),fullButtonSize=CONTROLS.querySelector(".control__icon--size"),fullButtonMin=CONTROLS.querySelector(".control__icon--min");function openFullscreen(){WRAPPER.requestFullscreen?WRAPPER.requestFullscreen():WRAPPER.mozRequestFullScreen&&WRAPPER.mozRequestFullScreen()}function exitFullscreen(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen&&document.mozCancelFullScreen()}function changeFullscreen(){document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement?(exitFullscreen(),fullButton.setAttribute("aria-label","На весь екран"),fullButton.setAttribute("title","На весь екран (f)"),fullButtonSize.classList.toggle("control__icon--hide"),fullButtonMin.classList.toggle("control__icon--hide")):(openFullscreen(),fullButton.setAttribute("aria-label","Закрити повний екран"),fullButton.setAttribute("title","Закрити повний екран (esc)"),fullButtonSize.classList.toggle("control__icon--hide"),fullButtonMin.classList.toggle("control__icon--hide"))}let mouseStoppedTimer,errorTimeout;function handleMouseMove(e){clearTimeout(mouseStoppedTimer);e.target===CONTROLS||CONTROLS.contains(e.target)||(showControls(),mouseStoppedTimer=setTimeout((()=>{hideControls()}),3e3))}function showControls(){CONTROLS.style.transform="translateY(0)",STATISTICS.style.transform="translateY(0)",statisticsUFH.style.transform="translateY(0)",VIDEO.style.cursor="auto"}function hideControls(){CONTROLS.style.transform="translateY(100%)",STATISTICS.style.transform="translateY(-100%)",statisticsUFH.style.transform="translateY(-150%)",VIDEO.style.cursor="none"}function showError(e){clearTimeout(errorTimeout),ERROR.classList.remove("error--hide"),ERROR.innerHTML=e,ERROR.classList.contains("error--animate")||ERROR.classList.add("error--animate"),errorTimeout=setTimeout((()=>{ERROR.classList.remove("error--animate"),ERROR.classList.add("error--hide")}),2e3)}fullButton.addEventListener("click",changeFullscreen),VIDEO.addEventListener("dblclick",changeFullscreen),WRAPPER.addEventListener("mousemove",handleMouseMove),WRAPPER.addEventListener("mouseleave",hideControls);const INPUTFILE=document.querySelector(".settings__file");let fileSize,fileType,selectedVideos=[];function handleFileSelection(e){let t=e.target.files;SERIESLIST.innerHTML="",Array.from(t).forEach(((e,t)=>{let o=URL.createObjectURL(e),n=e.name;selectedVideos.push({file:e,url:o,name:e.name,type:e.type,size:e.size});const s=document.createElement("li");s.className="series__item";const i=document.createElement("button");i.className="button series__button",i.type="button",i.textContent=n,s.appendChild(i),SERIESLIST.appendChild(s),i.addEventListener("click",(()=>{currentVideoIndex=t,playCurrentVideo(),setActiveButton(i),VIDEO.src=o})),0===t&&i.classList.add("series__button--active")})),validateFiles(selectedVideos)}INPUTFILE.addEventListener("change",resetVideo),INPUTFILE.addEventListener("change",handleFileSelection);const MAX_FILE_SIZE=5368709120;function validateFiles(e){e.forEach((e=>{fileSize=e.file.size,fileType=e.file.type,fileSize>MAX_FILE_SIZE?(showError("Файл завеликий &#128548;"),INPUTFILE.value=""):isSupportedFileType(fileType)?(showError("Відео обрано, готові грати &#128526;"),VIDEO.setAttribute("crossorigin","anonymous"),playCurrentVideo()):(showError("Непідтримуваний тип файлу &#128552;"),INPUTFILE.value="")}))}function isSupportedFileType(e){return["video/mp4","video/webm","video/mkv","video/mov"].includes(e)}const prevButton=CONTROLS.querySelector(".control__button--prev"),nextButton=CONTROLS.querySelector(".control__button--next");let currentVideo,videoKey,currentCategory="TheWitcher",currentSubcategory="deep",currentVideoIndex=0,data=null;function playCurrentVideo(){playButtonIcon.classList.add("control__icon--hide"),pauseButtonIcon.classList.remove("control__icon--hide"),stopProgress(),resetDuration(),updateActiveButton(),currentVideo=selectedVideos.length>0?selectedVideos[currentVideoIndex]:data[currentCategory][currentSubcategory][currentVideoIndex],VIDEO.setAttribute("src",currentVideo.src),VIDEO.setAttribute("alt",currentVideo.description),currentVideo.subtitles?subtitleButton.classList.remove("control__button--off"):subtitleButton.classList.add("control__button--off"),VIDEO.addEventListener("error",(function(){showError("Не вдалось завантажити відео &#128531;"),resetVideo()}))}function nextVideo(){if(selectedVideos.length>0)currentVideoIndex++,currentVideoIndex>=selectedVideos.length&&(currentVideoIndex=0);else if(currentVideoIndex++,currentVideoIndex>=data[currentCategory][currentSubcategory].length){const e=Object.keys(data[currentCategory]),t=e.indexOf(currentSubcategory);if(t<e.length-1)currentSubcategory=e[t+1],currentVideoIndex=0;else{const e=Object.keys(data),t=e.indexOf(currentCategory);t<e.length-1?(currentCategory=e[t+1],currentSubcategory=Object.keys(data[currentCategory])[0],currentVideoIndex=0):(currentCategory=e[0],currentSubcategory=Object.keys(data[currentCategory])[0],currentVideoIndex=0)}}playCurrentVideo()}function previousVideo(){if(selectedVideos.length>0)currentVideoIndex--,currentVideoIndex<0&&(currentVideoIndex=selectedVideos.length-1);else if(currentVideoIndex>0)currentVideoIndex--;else{const e=Object.keys(data[currentCategory]),t=e.indexOf(currentSubcategory);if(t>0)currentSubcategory=e[t-1],currentVideoIndex=data[currentCategory][currentSubcategory].length-1;else{const e=Object.keys(data),t=e.indexOf(currentCategory);if(t>0){currentCategory=e[t-1];const o=Object.keys(data[currentCategory]).pop();currentSubcategory=o,currentVideoIndex=data[currentCategory][o].length-1}else{currentCategory=e[e.length-1];const t=Object.keys(data[currentCategory]).pop();currentSubcategory=t,currentVideoIndex=data[currentCategory][t].length-1}}}playCurrentVideo()}function saveScheme(e){localStorage.setItem("color-scheme",e)}function clearScheme(){localStorage.removeItem("color-scheme")}function getSavedScheme(){return localStorage.getItem("color-scheme")}fetch("videos.json").then((e=>{if(!e.ok)throw showError("Помилка загрузки json &#128531;"),new Error("Failed to load videos.json");return e.json()})).then((e=>{data=e,currentCategory="TheWitcher",currentSubcategory="deep",currentVideoIndex=0,playCurrentVideo()})).catch((e=>{console.error("An error occurred:",e)})),nextButton.addEventListener("click",nextVideo),prevButton.addEventListener("click",previousVideo),VIDEO.addEventListener("ended",nextVideo),window.addEventListener("keyup",(e=>{switch(videoKey=e.key,videoKey){case" ":pauseVideo(),changePauseIcon();break;case"ArrowLeft":VIDEO.currentTime-=5,VIDEORANGE.value=VIDEO.currentTime,setDuration();break;case"ArrowRight":VIDEO.currentTime+=5,VIDEORANGE.value=VIDEO.currentTime,setDuration();break;case"ArrowUp":changeVolume(.1);break;case"ArrowDown":changeVolume(-.1);break;case"m":muteVideo(),changeMuteIcon();break;case"c":changeSubtitle();break;case"s":changeSpeed();break;case"q":openPip();break;case"x":changeFitscreen();break;case"f":changeFullscreen();break;case",":previousVideo();break;case".":nextVideo();break;case"i":openSettings();break;case"Escape":closeSettings(),openConsole();break;case"p":startVideo();break;case"l":setScheme("light"),setupSwitcher();break;case"d":setScheme("dark"),setupSwitcher();break;case"a":setScheme("auto"),setupSwitcher();break;case"t":setCinema();break;case"`":openConsole()}}));const favicon=document.querySelector('link[href="img/favicons/favicon.svg"]'),lightStyles=document.querySelectorAll("link[rel=stylesheet][media*=prefers-color-scheme][media*=light]"),darkStyles=document.querySelectorAll("link[rel=stylesheet][media*=prefers-color-scheme][media*=dark]"),schemeRadios=document.querySelectorAll(".footer__scheme"),darkScheme=matchMedia("(prefers-color-scheme: dark)").matches;function setupSwitcher(){const e=getSavedScheme();if(null!==e){document.querySelector(`.footer__scheme[value=${e}]`).checked=!0}else{document.querySelector(".footer__scheme[value=auto]").checked=!0}[...schemeRadios].forEach((e=>{e.addEventListener("change",(e=>{setScheme(e.target.value)}))}))}function setupScheme(){const e=getSavedScheme(),t=getSystemScheme();null!==e&&e!==t&&setScheme(e)}function setScheme(e){switchMedia(e),"auto"===e?clearScheme():saveScheme(e)}function switchMedia(e){let t,o;"auto"===e?(t="(prefers-color-scheme: light)",o="(prefers-color-scheme: dark)"):(t="light"===e?"all":"not all",o="dark"===e?"all":"not all"),[...lightStyles].forEach((e=>{e.media=t})),[...darkStyles].forEach((e=>{e.media=o})),favicon.href="dark"===e?"img/favicons/favicon-dark.svg":"img/favicons/favicon.svg"}function getSystemScheme(){return darkScheme?"dark":"light"}function setActiveButton(e){SERIESLIST.querySelectorAll(".series__button").forEach((e=>{e.classList.remove("series__button--active")})),e.classList.add("series__button--active")}function updateActiveButton(){SERIESLIST.querySelectorAll(".series__button").forEach(((e,t)=>{t===currentVideoIndex?e.classList.add("series__button--active"):e.classList.remove("series__button--active")}))}let game;setupSwitcher(),setupScheme();const chooseButtons=document.querySelectorAll(".settings__video");function setVideo(){VIDEO.src="video/"+game+"/"+deepFlag+".webm",VIDEO.preload="auto"}function resetVideo(){VIDEO.pause(),VIDEO.removeAttribute("crossorigin"),WRAPPER.className="video__wrapper",STARTBUTTON.classList.remove("video__start--hide"),CONTROLS.classList.add("control--hide"),STATISTICS.classList.add("statistics--hide"),statisticsUFH.classList.add("statistics--off"),playButtonIcon.classList.add("control__icon--hide"),pauseButtonIcon.classList.remove("control__icon--hide"),stopProgress(),resetDuration()}chooseButtons.forEach((e=>{e.addEventListener("click",(function(){game=this.getAttribute("data-video"),resetVideo(),setVideo(),deepCheckbox.removeAttribute("disabled","disabled")}))}));const openButton=document.querySelector(".header__menu"),closeButton=SETTINGS.querySelector(".settings__close");let settingsOpen=!1;function openSettings(){settingsOpen?(settingsOpen=!1,SETTINGS.classList.add("settings--hide"),SETTINGS.blur()):(settingsOpen=!0,SETTINGS.classList.remove("settings--hide"),SETTINGS.focus())}function closeSettings(){settingsOpen=!1,SETTINGS.classList.add("settings--hide"),SETTINGS.blur()}openButton.addEventListener("click",openSettings),closeButton.addEventListener("click",closeSettings);const statisticsCheckbox=SETTINGS.querySelector(".settings__checkbox--statistics"),statisticsAdditionalCheckbox=SETTINGS.querySelector(".settings__checkbox--additional"),statisticsAdditional=SETTINGS.querySelector(".settings__label--add"),statisticsHiddenCategory=STATISTICS.querySelectorAll(".statistics__category--hide");function showAddCheckbox(e){const t=e.currentTarget.checked;STATISTICS.classList.toggle("statistics--off",!t),statisticsAdditional.classList.toggle("settings__label--hide",!t),statisticsAdditionalCheckbox.disabled=!t,t||(statisticsAdditionalCheckbox.checked=!1,statisticsHiddenCategory.forEach((e=>{e.classList.add("statistics__category--hide")})))}function showAddStatistic(e){const t=e.currentTarget.checked;t?statisticsHiddenCategory.forEach((e=>{e.classList.remove("statistics__category--hide")})):statisticsHiddenCategory.forEach((e=>{e.classList.add("statistics__category--hide")})),t||(statisticsAdditionalCheckbox.checked=!1)}statisticsCheckbox.addEventListener("change",showAddCheckbox),statisticsAdditionalCheckbox.addEventListener("change",showAddStatistic);let deepFlag="main";const deepCheckbox=SETTINGS.querySelector(".settings__checkbox--deep");deepCheckbox.addEventListener("change",(function(e){deepFlag=e.currentTarget.checked?"deep":"main",setVideo()}));const scaleCheckbox=SETTINGS.querySelector(".settings__checkbox--scale");function setupScale(){scaleCheckbox.checked?BODY.addEventListener("mousemove",setScale):(WRAPPER.removeAttribute("style"),BODY.removeEventListener("mousemove",setScale))}function setScale(e){if(scaleCheckbox.checked&&e.isTrusted){let t=-20*-(e.pageX/window.innerWidth-.5),o=-20*(e.pageY/window.innerHeight-.5),n=VIDEO.getBoundingClientRect(),s=e.clientX-n.left,i=e.clientY-n.top;s>=0&&s<n.width&&i>=0&&i<n.height?WRAPPER.style.transform="perspective(1000px) rotateY(0deg) rotateX(0deg) scaleZ(1)":WRAPPER.style.transform="perspective(1000px) rotateY("+t+"deg) rotateX("+o+"deg) scaleZ(2)"}}let lineProgress;scaleCheckbox.addEventListener("change",setupScale);const line=CONTROLS.querySelector(".control__line"),lineCheckbox=SETTINGS.querySelector(".settings__checkbox--line");function showExtraLine(){lineCheckbox.checked?line.classList.remove("control__line--hide"):line.classList.add("control__line--hide")}function extraLine(){lineProgress=Math.round(videoCurrentTime/videoDuration*100),line.style.width=lineProgress+"%",line.value=lineProgress}lineCheckbox.addEventListener("change",showExtraLine);const controlsCheckbox=SETTINGS.querySelector(".settings__checkbox--controls"),additionalControls=CONTROLS.querySelectorAll(".control__button--hide");function showAddControls(){additionalControls.forEach((e=>{controlsCheckbox.checked?(e.classList.remove("control__button--hide"),e.removeAttribute("disabled")):(e.classList.add("control__button--hide"),e.setAttribute("disabled","disabled"))}))}controlsCheckbox.addEventListener("change",showAddControls);let autoplayFlag=!0;const autoplayCheckbox=SETTINGS.querySelector(".settings__checkbox--autoplay");function setAutoplay(){autoplayFlag=!!autoplayCheckbox.checked}autoplayCheckbox.addEventListener("change",setAutoplay);const seriesCheckbox=SETTINGS.querySelector(".settings__checkbox--series");function showSeriesList(){seriesCheckbox.checked?SERIESLIST.classList.remove("series--off"):SERIESLIST.classList.add("series--off")}function startVideo(){!VIDEO.hasAttribute("src")||""===VIDEO.src||VIDEO.error?(openButton.focus(),openButton.classList.add("header__menu--error"),setTimeout((()=>{openButton.classList.remove("header__menu--error")}),2e3),VIDEO.error&&showError(VIDEO.error.message)):(VIDEO.readyState>=VIDEO.HAVE_CURRENT_DATA||VIDEO.readyState===HTMLMediaElement.HAVE_ENOUGH_DATA)&&(openButton.classList.remove("header__menu--error"),STARTBUTTON.classList.add("video__start--hide"),CONTROLS.classList.remove("control--off","control--hide"),autoplayFlag?VIDEO.addEventListener("loadeddata",startVideo):VIDEO.removeEventListener("loadeddata",startVideo),VIDEO.play(),VIDEO.focus(),getStatistics(),stayFocus())}let videoWidth,videoHeight,videoFormat,videoDuration,videoBuffer,videoCurrentTime;seriesCheckbox.addEventListener("change",showSeriesList),STARTBUTTON.addEventListener("click",startVideo);let windowWidth=window.innerWidth,windowHeight=window.innerHeight;const statisticsClientTime=STATISTICS.querySelector(".statistics__time"),statisticsEndTime=STATISTICS.querySelector(".statistics__end"),statisticsResolution=STATISTICS.querySelector(".statistics__resolution"),statisticsUFH=document.querySelector(".statistics__ufh"),statisticsFormat=STATISTICS.querySelector(".statistics__format"),statisticsDuration=STATISTICS.querySelector(".statistics__duration"),statisticsBuffer=STATISTICS.querySelector(".statistics__buffer");function getStatistics(){STATISTICS.classList.remove("statistics--hide"),videoFormat=fileType?fileType.replace("video/",""):VIDEO.src.split(".").pop(),videoWidth=VIDEO.videoWidth,videoHeight=VIDEO.videoHeight,videoDuration=Math.round(VIDEO.duration),VIDEORANGE.setAttribute("max",videoDuration),checkFitscreen(),setStatistics()}function setStatistics(){statisticsResolution.innerHTML=videoWidth+"x"+videoHeight,statisticsFormat.innerHTML=videoFormat,statisticsDuration.innerHTML=videoDuration,videoWidth>=3840?statisticsUFH.classList.remove("statistics--off"):statisticsUFH.classList.add("statistics--off")}function getTime(){const e=new Date,t=e.getHours(),o=e.getMinutes();statisticsClientTime.innerHTML=t+":"+o}function getEndTime(){const e=new Date;e.setSeconds(e.getSeconds()+videoDuration);const t=e.getHours(),o=e.getMinutes();statisticsEndTime.innerHTML=t+":"+o}const subtitle=VIDEO.querySelector(".video__subtitle"),subtitleTrack=subtitle.track,subtitleButton=CONTROLS.querySelector(".control__button--subtitle"),subtitleInfo=subtitleButton.querySelector(".control__info");subtitle.default=!1,subtitleTrack.mode="hidden";let currentSubtitleIndex=-1;function changeSubtitle(){currentSubtitleIndex++;const e=Object.keys(currentVideo.subtitles);if(currentSubtitleIndex>=e.length)return currentSubtitleIndex=-1,void clearSubtitle();const t=e[currentSubtitleIndex],o=currentVideo.subtitles[t];subtitle.src=o.src,subtitle.srclang=o.srclang,subtitle.label=o.label,subtitle.default=!0,subtitleTrack.mode="showing",subtitleButton.setAttribute("aria-label","Вимкнути субтитри"),subtitleButton.setAttribute("title","Вимкнути субтитри (c)"),subtitleButton.classList.add("control__button--active"),subtitleInfo.classList.remove("control__info--hide"),subtitleInfo.innerHTML=o.srclang}function clearSubtitle(){subtitle.src="",subtitle.srclang="",subtitle.label="",subtitle.default=!1,subtitleTrack.mode="hidden",subtitleButton.setAttribute("aria-label","Увімкнути субтитри"),subtitleButton.setAttribute("title","Увімкнути субтитри (c)"),subtitleButton.classList.remove("control__button--active"),subtitleInfo.classList.add("control__info--hide")}subtitleButton.addEventListener("click",changeSubtitle);const tabButtons=SETTINGS.querySelectorAll(".settings__button"),tabs=SETTINGS.querySelectorAll(".settings__tab");function updateSettingsHeight(){let e=SETTINGS.querySelector(".settings__control").clientHeight;const t=SETTINGS.querySelector(".settings__wrapper");let o=t.clientHeight;const n=SETTINGS.querySelector(".settings__tab--active");let s=n.clientHeight,i=90;windowWidth>768&&(i=0),t.style.height=`calc(100vh - ${e}px - ${i}px)`,s>o?n.classList.add("settings__tab--scroll"):n.classList.remove("settings__tab--scroll")}let progressInterval,playbackQuality,currentVideoPassed,currentVideoLeft;function startProgress(){progressInterval=setTimeout(updateProgress,1e3)}function updateProgress(){videoBuffer=Math.round(VIDEO.buffered.end(0)),statisticsBuffer.innerHTML=videoBuffer,videoCurrentTime=Math.round(VIDEO.currentTime),VIDEORANGE.value=videoCurrentTime,currentVideoPassed=formatTime(videoCurrentTime),currentVideoLeft=formatTime(videoDuration-videoCurrentTime),videoPassed.innerHTML=currentVideoPassed,videoLeft.innerHTML=currentVideoLeft,startProgress(),getTime(),getEndTime(),extraLine()}function stopProgress(){clearTimeout(progressInterval)}function stayFocus(){VIDEO.paused?VIDEO.blur():VIDEO.focus()}function waitingVideo(){WRAPPER.classList.remove("video__wrapper--pause"),WRAPPER.classList.add("video__wrapper--waiting")}function playingVideo(){WRAPPER.classList.remove("video__wrapper--waiting")}function errorVideo(){WRAPPER.classList.add("video__wrapper--error"),showError("Помилка відео &#128528;")}function removeErrorVideo(){WRAPPER.classList.remove("video__wrapper--error")}function pauseAnimation(){WRAPPER.classList.add("video__wrapper--pause")}function removePauseAnimation(){WRAPPER.classList.remove("video__wrapper--pause")}tabButtons.forEach((e=>{e.addEventListener("click",(()=>{tabButtons.forEach((e=>e.classList.remove("settings__button--active"))),tabs.forEach((e=>{e.classList.remove("settings__tab--active"),e.classList.remove("settings__tab--scroll"),e.removeAttribute("tabIndex")})),e.classList.add("settings__button--active");const t=e.getAttribute("data-tab");document.querySelector(`.settings__tab[data-tab="${t}"]`).classList.add("settings__tab--active"),document.querySelector(`.settings__tab[data-tab="${t}"]`).setAttribute("tabIndex","0"),document.querySelector(`.settings__tab[data-tab="${t}"]`).focus(),updateSettingsHeight()}))})),updateSettingsHeight(),window.addEventListener("resize",updateSettingsHeight),VIDEO.addEventListener("play",startProgress),VIDEO.addEventListener("pause",stopProgress),VIDEO.addEventListener("ended",stopProgress),VIDEO.addEventListener("waiting",waitingVideo),VIDEO.addEventListener("playing",playingVideo),VIDEO.addEventListener("loadeddata",removeErrorVideo),VIDEO.addEventListener("pause",pauseAnimation),VIDEO.addEventListener("playing",removePauseAnimation),VIDEO.addEventListener("ended",removePauseAnimation);