const BODY=document.querySelector(".body"),HEADER=document.querySelector(".header"),FOOTER=document.querySelector(".footer"),MAIN=document.querySelector(".main"),VIDEO=document.querySelector(".video"),WRAPPER=document.querySelector(".video__wrapper"),SETTINGS=document.querySelector(".settings"),STATISTICS=document.querySelector(".statistics"),SERIES_LIST=document.querySelector(".series"),VIDEO_RANGE=document.querySelector(".control__range--duration"),START_BUTTON=document.querySelector(".video__start"),CONTROLS=document.querySelector(".control"),MESSAGE=document.querySelector(".message"),openButton=document.querySelector(".header__menu"),closeButton=SETTINGS.querySelector(".settings__close");let settingsOpen=!1;function openSettings(){settingsOpen?(settingsOpen=!1,SETTINGS.classList.add("settings--hide"),SETTINGS.blur()):(settingsOpen=!0,SETTINGS.classList.remove("settings--hide"),SETTINGS.focus()),checkActiveTab()}function closeSettings(){settingsOpen=!1,SETTINGS.classList.add("settings--hide"),SETTINGS.blur(),checkActiveTab()}openButton.addEventListener("click",openSettings),closeButton.addEventListener("click",closeSettings);const statisticsCheckbox=SETTINGS.querySelector(".settings__checkbox--statistics"),statisticsAdditionalCheckbox=SETTINGS.querySelector(".settings__checkbox--additional"),statisticsAdditional=SETTINGS.querySelector(".settings__label--add"),statisticsHiddenCategory=STATISTICS.querySelectorAll(".statistics__category--hide");function showAddCheckbox(e){const t=e.currentTarget.checked;STATISTICS.classList.toggle("statistics--off",!t),statisticsAdditional.classList.toggle("settings__label--hide",!t),statisticsAdditionalCheckbox.disabled=!t,t||(statisticsAdditionalCheckbox.checked=!1,statisticsHiddenCategory.forEach((e=>{e.classList.add("statistics__category--hide")})))}function showAddStatistic(e){const t=e.currentTarget.checked;t?statisticsHiddenCategory.forEach((e=>{e.classList.remove("statistics__category--hide")})):statisticsHiddenCategory.forEach((e=>{e.classList.add("statistics__category--hide")})),t||(statisticsAdditionalCheckbox.checked=!1)}statisticsCheckbox.addEventListener("change",showAddCheckbox),statisticsAdditionalCheckbox.addEventListener("change",showAddStatistic);const scaleCheckbox=SETTINGS.querySelector(".settings__checkbox--scale");function setupScale(){scaleCheckbox.checked?BODY.addEventListener("mousemove",setScale):(WRAPPER.removeAttribute("style"),BODY.removeEventListener("mousemove",setScale))}function setScale(e){if(scaleCheckbox.checked&&e.isTrusted){let t=-20*-(e.pageX/window.innerWidth-.5),o=-20*(e.pageY/window.innerHeight-.5),s=VIDEO.getBoundingClientRect(),n=e.clientX-s.left,i=e.clientY-s.top;n>=0&&n<s.width&&i>=0&&i<s.height?WRAPPER.style.transform="perspective(1000px) rotateY(0deg) rotateX(0deg) scaleZ(1)":WRAPPER.style.transform="perspective(1000px) rotateY("+t+"deg) rotateX("+o+"deg) scaleZ(2)"}}scaleCheckbox.addEventListener("change",setupScale);let deepFlag="main";const deepCheckbox=SETTINGS.querySelector(".settings__checkbox--deep");let lineProgress;deepCheckbox.addEventListener("change",(function(e){deepFlag=e.currentTarget.checked?"deep":"main",setVideo()}));const line=CONTROLS.querySelector(".control__line"),lineCheckbox=SETTINGS.querySelector(".settings__checkbox--line");function showExtraLine(){lineCheckbox.checked?line.classList.remove("control__line--hide"):line.classList.add("control__line--hide")}function extraLine(){lineProgress=Math.round(videoCurrentTime/videoDuration*100),line.style.width=lineProgress+"%",line.value=lineProgress}lineCheckbox.addEventListener("change",showExtraLine);const controlsCheckbox=SETTINGS.querySelector(".settings__checkbox--controls"),additionalControls=CONTROLS.querySelectorAll(".control__button--hide");function showAddControls(){controlsCheckbox.checked=!controlsCheckbox.checked,additionalControls.forEach((e=>{controlsCheckbox.checked?(e.classList.remove("control__button--hide"),e.removeAttribute("disabled")):(e.classList.add("control__button--hide"),e.setAttribute("disabled","disabled"))}))}controlsCheckbox.addEventListener("change",showAddControls),controlsCheckbox.addEventListener("click",showAddControls);let autoplayFlag=!0;const autoplayCheckbox=SETTINGS.querySelector(".settings__checkbox--autoplay");function setAutoplay(){autoplayCheckbox.checked?(autoplayFlag=!0,VIDEO.addEventListener("loadeddata",startVideo)):(autoplayFlag=!1,VIDEO.removeEventListener("loadeddata",startVideo))}autoplayCheckbox.addEventListener("change",setAutoplay);const autoschemeCheckbox=SETTINGS.querySelector(".settings__checkbox--autoscheme");function setAutoscheme(){clearSchemeButtons(),autoschemeCheckbox.checked&&setScheme("auto")}function clearSchemeButtons(){const e=FOOTER.querySelector('.footer__scheme[value="light"]').parentNode,t=FOOTER.querySelector('.footer__scheme[value="dark"]').parentNode,o=FOOTER.querySelector('.footer__scheme[value="auto"]').parentNode;autoschemeCheckbox.checked?(e.classList.add("footer__label--hide"),t.classList.add("footer__label--hide"),setTimeout((()=>{e.classList.add("footer__label--off"),t.classList.add("footer__label--off")}),100),setTimeout((()=>{o.classList.remove("footer__label--off"),setTimeout((()=>{o.classList.remove("footer__label--hide")}),100)}),100)):(o.classList.add("footer__label--hide"),setTimeout((()=>{e.classList.remove("footer__label--off"),t.classList.remove("footer__label--off"),o.classList.add("footer__label--off"),setTimeout((()=>{e.classList.remove("footer__label--hide"),t.classList.remove("footer__label--hide")}),100)}),100))}autoschemeCheckbox.addEventListener("change",setAutoscheme);const blurCheckbox=SETTINGS.querySelector(".settings__checkbox--blur");blurCheckbox.addEventListener("change",(function(e){e.currentTarget.checked?BODY.classList.add("blur"):BODY.classList.remove("blur")}));const background=document.querySelector(".background"),backgroundCheckbox=SETTINGS.querySelector(".settings__checkbox--background"),backgroundVideo=document.querySelector(".background__video");function showBackground(){backgroundCheckbox.checked?(background.classList.remove("background--off"),backgroundVideo.src=VIDEO.src,videoCurrentTime&&(backgroundVideo.currentTime=videoCurrentTime)):background.classList.add("background--off")}backgroundCheckbox.addEventListener("change",showBackground);const seriesCheckbox=SETTINGS.querySelector(".settings__checkbox--series"),seriesLabel=SETTINGS.querySelector(".settings__label--series");function showSeriesList(){seriesCheckbox.checked?SERIES_LIST.classList.remove("series--off"):SERIES_LIST.classList.add("series--off")}seriesCheckbox.addEventListener("change",showSeriesList);const favicon=document.querySelector('link[href="img/favicons/favicon.svg"]'),schemeSwitcher=document.querySelector(".footer__switcher"),lightStyles=document.querySelectorAll("link[rel=stylesheet][media*=prefers-color-scheme][media*=light]"),darkStyles=document.querySelectorAll("link[rel=stylesheet][media*=prefers-color-scheme][media*=dark]"),schemeButton=document.querySelectorAll(".footer__scheme"),darkScheme=matchMedia("(prefers-color-scheme: dark)").matches;function setupSwitcher(){let e=getSavedScheme();null!==e&&updateRadioStates(document.querySelector(`.footer__scheme[value=${e}]`)),schemeSwitcher.addEventListener("change",(e=>{setScheme(e.target.value)}))}function updateRadioStates(e){[...schemeButton].forEach((t=>{t===e?(t.checked=!0,t.setAttribute("checked","checked")):(t.checked=!1,t.removeAttribute("checked"))}))}let savedScheme,systemScheme,newScheme;function setupScheme(){savedScheme=getSavedScheme(),systemScheme=getSystemScheme(),null!==savedScheme&&("vice"===savedScheme?addScheme("vice"):savedScheme!==systemScheme?setScheme(savedScheme):"light"===savedScheme?switchMedia("light"):"dark"===savedScheme?switchMedia("dark"):"auto"===savedScheme&&clearSchemeButtons())}function setScheme(e){switchMedia(e),"auto"===e?(saveScheme(e),autoschemeCheckbox.checked=!0):(saveScheme(e),autoschemeCheckbox.checked=!1),clearSchemeButtons(),updateRadioStates(document.querySelector(`.footer__scheme[value=${e}]`))}function switchMedia(e){let t,o;"auto"===e?(t="(prefers-color-scheme: light)",o="(prefers-color-scheme: dark)"):"light"===e?(t="all",o="not all"):"dark"===e?(t="not all",o="all"):(t="not all",o="not all"),[...lightStyles].forEach((e=>{e.media=t})),[...darkStyles].forEach((e=>{e.media=o})),favicon.href="dark"===e?"img/favicons/favicon-dark.svg":"img/favicons/favicon.svg",newScheme&&(newScheme.media="vice"===e?"all":"not all")}function getSystemScheme(){return darkScheme?"dark":"light"}function addScheme(e){let t=document.querySelector(`.footer__scheme[value=${e}]`),o=t.parentNode;updateRadioStates(t),o.classList.remove("footer__label--hide"),newScheme=document.createElement("link"),newScheme.setAttribute("rel","stylesheet"),newScheme.href=`css/${e}.css`,document.head.appendChild(newScheme),switchMedia(e),newScheme.setAttribute("media","all"),saveScheme(e)}function playBackgroundVideo(){backgroundVideo.play()}function pauseBackgroundVideo(){backgroundVideo.pause()}setupSwitcher(),setupScheme(),VIDEO.addEventListener("play",playBackgroundVideo),VIDEO.addEventListener("pause",pauseBackgroundVideo);const consoleContainer=document.querySelector(".console"),consoleClose=consoleContainer.querySelector(".console__close"),consoleBackground=consoleContainer.querySelector(".console__background"),consoleInput=consoleContainer.querySelector(".console__input");function openConsole(){consoleBackground.paused&&consoleBackground.play(),consoleContainer.classList.remove("console--hide"),consoleInput.focus()}function closeConsole(){consoleBackground.pause(),consoleContainer.classList.add("console--hide"),consoleInput.value="",consoleInput.blur()}consoleClose.addEventListener("click",closeConsole);const consoleCommands={"unlimited spider man":{videoSrc:"video/USP-intro.mp4",message:"Відкрито бонусне відео &#128375;"},"spider man":{videoSrc:"video/SP-intro.mp4",message:"Відкрито бонусне відео &#128375;"},"vice city":{videoSrc:"video/GTAVC-intro.webm",message:"Розблокована нова тема &#127847;",scheme:"vice"},"assassins creed 2":{videoSrc:"video/ACII-trailer.mp4",message:"Відкрито бонусне відео &#129413;"},tmnt:{videoSrc:"video/TMNT-intro.mp4",message:"Кавабанга &#127829;"}};function checkBonus(e){if("Enter"===e.key){resetVideo();let e=consoleInput.value.toLowerCase(),t=consoleCommands[e];t?(VIDEO.src=t.videoSrc,t.scheme&&addScheme(t.scheme),closeConsole(),showMessage(t.message)):showMessage("Команда неможлива &#128126;"),autoplayFlag?VIDEO.addEventListener("loadeddata",startVideo):VIDEO.removeEventListener("loadeddata",startVideo)}}function stopPropagation(e){e.stopPropagation()}consoleInput.addEventListener("input",stopPropagation),consoleInput.addEventListener("keyup",stopPropagation),consoleInput.addEventListener("keyup",checkBonus);const devButton=FOOTER.querySelector(".footer__copyright--dev"),MAX_DEV_CLICK_COUNT=10;let clickCount=0;function devClicks(){++clickCount>=10&&(openConsole(),clickCount=0)}devButton.addEventListener("click",devClicks),VIDEO.controls=!1;const playButton=CONTROLS.querySelector(".control__button--play"),playButtonIcon=CONTROLS.querySelector(".control__icon--play"),pauseButtonIcon=CONTROLS.querySelector(".control__icon--pause");function pauseVideo(){VIDEO.paused?VIDEO.play():VIDEO.pause()}function stopVideo(){VIDEO.pause()}function setPauseIcon(){playButtonIcon.classList.remove("control__icon--hide"),pauseButtonIcon.classList.add("control__icon--hide")}function setPlayIcon(){playButtonIcon.classList.add("control__icon--hide"),pauseButtonIcon.classList.remove("control__icon--hide")}playButton.addEventListener("click",pauseVideo),VIDEO.addEventListener("click",pauseVideo),VIDEO.addEventListener("pause",setPauseIcon),VIDEO.addEventListener("play",setPlayIcon);const muteButton=CONTROLS.querySelector(".control__button--mute"),muteButtonIcon=CONTROLS.querySelector("#muted");function setMute(){VIDEO.muted?unmuteVideo():muteVideo(),changeMuteIcon()}function muteVideo(){let e=VIDEO.volume;VIDEO.muted=!0,volumeRange.value=0,e>0&&(savedVolumeBeforeMute=e)}function unmuteVideo(){savedVolumeBeforeMute>=0&&(VIDEO.muted=!1,VIDEO.volume=savedVolumeBeforeMute,volumeRange.value=savedVolumeBeforeMute)}function changeMuteIcon(){const e=VIDEO.muted;muteButtonIcon.classList.toggle("control__icon--unmuted",!e),muteButtonIcon.classList.toggle("control__icon--muted",e),muteButton.classList.toggle("control__button--active",e)}muteButton.addEventListener("click",setMute),VIDEO.volume=.5;const volumeRange=CONTROLS.querySelector(".control__range--volume");function changeVolume(e){let t=Math.max(0,Math.min(1,VIDEO.volume+e));VIDEO.volume=t,volumeRange.value=t,updateVolume()}function updateVolume(){VIDEO.volume=volumeRange.value,0===VIDEO.volume?VIDEO.muted=!0:VIDEO.muted=!1,changeMuteIcon()}function wheelVolume(e){if(e.preventDefault(),void 0!==e.deltaY&&!isNaN(e.deltaY)){changeVolume(.1*-Math.sign(e.deltaY))}}volumeRange.addEventListener("input",updateVolume),volumeRange.addEventListener("wheel",wheelVolume);const videoPassed=CONTROLS.querySelector(".control__time--passed"),videoLeft=CONTROLS.querySelector(".control__time--left");function setDuration(){let e=VIDEO_RANGE.value;VIDEO.currentTime=e,videoPassed.innerHTML=formatTime(e),videoLeft.innerHTML=formatTime(videoDuration-e),line.value=e,line.style.width=Math.round(e/videoDuration*100)+"%"}function resetDuration(){VIDEO_RANGE.value="0",videoPassed.innerHTML=formatTime(0),videoLeft.innerHTML=formatTime(0),line.style.width="0%",line.value=0}function formatTime(e){let t=Math.floor(e/3600),o=Math.floor((e-3600*t)/60),s=Math.floor(e-3600*t-60*o);return t=t<10?"0"+t:t,o=o<10?"0"+o:o,s=s<10?"0"+s:s,t+":"+o+":"+s}function wheelDuration(e){e.preventDefault();const t=-Math.sign(e.deltaY);let o=parseFloat(VIDEO_RANGE.value)+t;VIDEO_RANGE.value=o,VIDEO.currentTime=VIDEO_RANGE.value,setDuration()}VIDEO_RANGE.addEventListener("mousedown",stopVideo),VIDEO_RANGE.addEventListener("input",setDuration),VIDEO_RANGE.addEventListener("change",pauseVideo),VIDEO_RANGE.addEventListener("wheel",wheelDuration);let playbackRate=1;const SPEED_INCREMENT=.25,MIN_SPEED=.25,MAX_SPEED=2,speedButton=CONTROLS.querySelector(".control__button--speed"),speedInfo=speedButton.querySelector(".control__info");function changeSpeed(){playbackRate+=SPEED_INCREMENT,playbackRate>MAX_SPEED&&(playbackRate=MIN_SPEED),VIDEO.playbackRate=playbackRate,speedInfo.classList.remove("control__info--hide"),speedInfo.innerHTML=playbackRate+"x",1!==playbackRate?speedButton.classList.add("control__button--active"):(speedButton.classList.remove("control__button--active"),speedInfo.classList.add("control__info--hide"))}speedButton.addEventListener("click",changeSpeed);const pipButton=CONTROLS.querySelector(".control__button--pip");function setPictureInPicture(){document.pictureInPictureElement?(VIDEO.setAttribute("disablePictureInPicture","disablePictureInPicture"),exitPictureInPicture()):(VIDEO.removeAttribute("disablePictureInPicture"),enterPictureInPicture())}function enterPictureInPicture(){VIDEO.requestPictureInPicture().then((()=>{pipButton.classList.add("control__button--active"),updatePipButtonAttributes("Закрити міні-програвач","Закрити міні-програвач (p)")})).catch((e=>{console.error(e)}))}function exitPictureInPicture(){document.pictureInPictureElement&&document.exitPictureInPicture().then((()=>{pipButton.classList.remove("control__button--active"),updatePipButtonAttributes("Міні-програвач","Міні-програвач (p)")})).catch((e=>{console.error(e)}))}function updatePipButtonAttributes(e,t){pipButton.setAttribute("aria-label",e),pipButton.setAttribute("title",t)}pipButton.addEventListener("click",setPictureInPicture),document.addEventListener("leavepictureinpicture",exitPictureInPicture);const fitButton=CONTROLS.querySelector(".control__button--fit");function changeFitScreen(){let e="cover"===VIDEO.style.objectFit?"contain":"cover";VIDEO.style.objectFit=e,"contain"===e?(fitButton.classList.toggle("control__button--active"),fitButton.setAttribute("aria-label","Ростягнути зображення"),fitButton.setAttribute("title","Ростягнути зображення (x)")):(fitButton.classList.toggle("control__button--active"),fitButton.setAttribute("aria-label","Зменшити зображення"),fitButton.setAttribute("title","Зменшити зображення (x)"))}fitButton.addEventListener("click",changeFitScreen);let cinemaFlag=!1;const cinemaButton=CONTROLS.querySelector(".control__button--cinema");function enterCinemaMode(){HEADER.classList.add("header--hide"),FOOTER.classList.add("footer--hide"),SERIES_LIST.classList.add("series--off"),BODY.style.overflow="hidden",setTimeout((()=>{HEADER.style.display="none",FOOTER.style.display="none",WRAPPER.classList.add("video__wrapper--cinema"),MAIN.classList.add("main--cinema"),VIDEO.focus()}),250)}function exitCinemaMode(){seriesCheckbox.checked&&SERIES_LIST.classList.remove("series--off"),HEADER.style.display="flex",FOOTER.style.display="flex",WRAPPER.classList.remove("video__wrapper--cinema"),MAIN.classList.remove("main--cinema"),VIDEO.blur(),BODY.removeAttribute("style"),setTimeout((()=>{HEADER.classList.remove("header--hide"),FOOTER.classList.remove("footer--hide")}),250)}function setCinemaMode(){cinemaFlag=!cinemaFlag,cinemaButton.classList.toggle("control__button--active"),cinemaFlag?(cinemaButton.setAttribute("aria-label","Вийти з режиму кінотеатра"),cinemaButton.setAttribute("title","Вийти з режиму кінотеатра (t)"),enterCinemaMode()):(cinemaButton.setAttribute("aria-label","Режим кінотеатру"),cinemaButton.setAttribute("title","Режим кінотеатру (t)"),exitCinemaMode())}BODY.clientWidth>768&&cinemaButton.classList.remove("control__button--off"),cinemaButton.addEventListener("click",setCinemaMode);const fullButton=CONTROLS.querySelector(".control__button--size"),fullButtonSize=CONTROLS.querySelector(".control__icon--size"),fullButtonMin=CONTROLS.querySelector(".control__icon--min");function setFullscreen(){document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement?document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen&&document.mozCancelFullScreen():WRAPPER.requestFullscreen?WRAPPER.requestFullscreen():WRAPPER.mozRequestFullScreen&&WRAPPER.mozRequestFullScreen()}function updateFullscreenButton(){const e=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement;fullButton.setAttribute("aria-label",e?"Закрити повний екран":"На весь екран"),fullButton.setAttribute("title",e?"Закрити повний екран (esc)":"На весь екран (f)"),fullButtonSize.classList.toggle("control__icon--hide",e),fullButtonMin.classList.toggle("control__icon--hide",!e)}let hideControlsTimer;function handleMouseMove(){clearTimeout(hideControlsTimer),showControls(),hideControlsTimer=setTimeout((()=>{hideControls()}),3e3)}function showControls(){statisticsName.classList.remove("video__name--hide"),VIDEO.style.cursor="auto",STATISTICS.classList.remove("statistics--hide"),CONTROLS.classList.remove("control--hide")}function hideControls(){statisticsName.classList.add("video__name--hide"),VIDEO.style.cursor="none",STATISTICS.classList.add("statistics--hide"),CONTROLS.classList.add("control--hide")}function resetHideControlsTimer(){clearTimeout(hideControlsTimer),hideControlsTimer=setTimeout((()=>{hideControls()}),3e3)}fullButton.addEventListener("click",setFullscreen),WRAPPER.addEventListener("dblclick",setFullscreen),document.addEventListener("fullscreenchange",updateFullscreenButton),document.addEventListener("webkitfullscreenchange",updateFullscreenButton),document.addEventListener("mozfullscreenchange",updateFullscreenButton),WRAPPER.addEventListener("mousemove",handleMouseMove),WRAPPER.addEventListener("mouseleave",hideControls),WRAPPER.addEventListener("mouseenter",resetHideControlsTimer);const INPUTFILE=document.querySelector(".settings__file"),MAX_FILE_SIZE=5368709120,supportedFormats=["video/mp4","video/webm","video/mkv","video/mov"];let uploadedVideo=[];function handleFiles(e){Array.from(e.target.files).forEach((e=>{const t=URL.createObjectURL(e);uploadedVideo.push({file:e,url:t,src:t,name:e.name,type:e.type,size:e.size})})),validateFiles(uploadedVideo)}function validateFiles(e){let t=!0;e.forEach((e=>{let o=e.file.size,s=e.file.type;o>MAX_FILE_SIZE?(showMessage("Файл завеликий &#128548;"),t=!1):isSupportedFileType(s)||(showMessage("Непідтримуваний тип файлу &#128552;"),t=!1)})),t&&(e.length>1&&seriesLabel.classList.remove("settings__label--hide"),VIDEO.setAttribute("crossorigin","anonymous"),generatingSeries(),playCurrentVideo(),showMessage("Кінострічка готова &#127909;")),INPUTFILE.value=""}function isSupportedFileType(e){return supportedFormats.includes(e)}INPUTFILE.addEventListener("change",resetVideo),INPUTFILE.addEventListener("change",handleFiles);const prevButton=CONTROLS.querySelector(".control__button--prev"),nextButton=CONTROLS.querySelector(".control__button--next");let currentVideo,currentCategory="TheWitcher",currentSubcategory="deep",currentVideoIndex=0,data=null;function playCurrentVideo(){setPlayIcon(),stopProgress(),resetDuration(),updateActiveButton(),autoplayFlag||resetVideo(),currentVideo=uploadedVideo.length>0?uploadedVideo[currentVideoIndex]:data[currentCategory][currentSubcategory][currentVideoIndex],VIDEO.setAttribute("src",currentVideo.src),VIDEO.setAttribute("alt",currentVideo.description),currentVideo.subtitles?subtitleButton.classList.remove("control__button--off"):subtitleButton.classList.add("control__button--off")}function changeVideoIndex(e){if(uploadedVideo.length>0)currentVideoIndex+=e,currentVideoIndex>=uploadedVideo.length?currentVideoIndex=0:currentVideoIndex<0&&(currentVideoIndex=uploadedVideo.length-1);else if(currentVideoIndex+=e,currentVideoIndex<0){const e=Object.keys(data[currentCategory]),t=e.indexOf(currentSubcategory);if(t>0)currentSubcategory=e[t-1],currentVideoIndex=data[currentCategory][currentSubcategory].length-1;else{const e=Object.keys(data),t=e.indexOf(currentCategory);if(t>0){currentCategory=e[t-1];const o=Object.keys(data[currentCategory]).pop();currentSubcategory=o,currentVideoIndex=data[currentCategory][o].length-1}else{currentCategory=e[e.length-1];const t=Object.keys(data[currentCategory]).pop();currentSubcategory=t,currentVideoIndex=data[currentCategory][t].length-1}}}else if(currentVideoIndex>=data[currentCategory][currentSubcategory].length){const e=Object.keys(data[currentCategory]),t=e.indexOf(currentSubcategory);if(t<e.length-1)currentSubcategory=e[t+1],currentVideoIndex=0;else{const e=Object.keys(data),t=e.indexOf(currentCategory);t<e.length-1?(currentCategory=e[t+1],currentSubcategory=Object.keys(data[currentCategory])[0],currentVideoIndex=0):(currentCategory=e[0],currentSubcategory=Object.keys(data[currentCategory])[0],currentVideoIndex=0)}}playCurrentVideo()}fetch("video.json").then((e=>{if(!e.ok)throw showMessage("Помилка загрузки json &#128531;"),Error("Failed to load video.json");return e.json()})).then((e=>{data=e,playCurrentVideo()})).catch((e=>{console.error("An error occurred:",e)})),nextButton.addEventListener("click",(()=>changeVideoIndex(1))),prevButton.addEventListener("click",(()=>changeVideoIndex(-1))),VIDEO.addEventListener("ended",(()=>changeVideoIndex(1)));const keyHandlers={playPause:" ",skipBackward:"ArrowLeft",skipForward:"ArrowRight",changeVolumeUp:"ArrowUp",changeVolumeDown:"ArrowDown",toggleMute:"m",setSubtitle:"c",changeSpeed:"s",openPIP:"p",toggleFitScreen:"x",toggleFullscreen:"f",openSettings:"i",closeSettings:"Escape",startVideo:"k",setLightScheme:"l",setDarkScheme:"d",setAutoScheme:"a",setCinemaMode:"t",openConsole:"`",showAddControls:"b",nextVideoIndex:".",prevVideoIndex:","};function handleKey(e,t){for(const o in t)if(t[o]===e)switch(o){case"playPause":pauseVideo();break;case"skipBackward":VIDEO.currentTime-=5,VIDEO_RANGE.value=VIDEO.currentTime,setDuration();break;case"skipForward":VIDEO.currentTime+=5,VIDEO_RANGE.value=VIDEO.currentTime,setDuration();break;case"changeVolumeUp":changeVolume(.1);break;case"changeVolumeDown":changeVolume(-.1);break;case"toggleMute":setMute();break;case"setSubtitle":setSubtitle();break;case"changeSpeed":changeSpeed();break;case"openPIP":setPictureInPicture();break;case"toggleFitScreen":changeFitScreen();break;case"toggleFullscreen":setFullscreen();break;case"openSettings":openSettings();break;case"closeSettings":closeSettings(),closeConsole();break;case"startVideo":startVideo();break;case"setLightScheme":setScheme("light");break;case"setDarkScheme":setScheme("dark");break;case"setAutoScheme":setScheme("auto");break;case"setCinemaMode":setCinemaMode();break;case"openConsole":openConsole();break;case"showAddControls":showAddControls();break;case"nextVideoIndex":changeVideoIndex(1);break;case"prevVideoIndex":changeVideoIndex(-1)}}function saveScheme(e){localStorage.setItem("color-scheme",e)}function clearScheme(){localStorage.removeItem("color-scheme")}function getSavedScheme(){return localStorage.getItem("color-scheme")}let messageTimeout;function showMessage(e,t=3e3){messageTimeout&&clearTimeout(messageTimeout),MESSAGE.classList.remove("message--hide"),MESSAGE.innerHTML=e,MESSAGE.classList.contains("message--animate")||MESSAGE.classList.add("message--animate"),messageTimeout=setTimeout(clearMessage,t)}function clearMessage(){MESSAGE.classList.remove("message--animate"),MESSAGE.classList.add("message--hide")}function generatingSeries(){SERIES_LIST.innerHTML="",Array.from(uploadedVideo).forEach(((e,t)=>{const o=document.createElement("li");o.className="series__item";const s=document.createElement("button");s.className="button series__button",s.type="button",s.textContent=e.name,o.appendChild(s),SERIES_LIST.appendChild(o),s.addEventListener("click",(()=>{setActiveButton(s),currentVideoIndex=t,VIDEO.src=e.url}))}))}function setActiveButton(e){SERIES_LIST.querySelectorAll(".series__button").forEach((e=>{e.classList.remove("series__button--active")})),e.classList.add("series__button--active")}function updateActiveButton(){SERIES_LIST.querySelectorAll(".series__button").forEach(((e,t)=>{t===currentVideoIndex?e.classList.add("series__button--active"):e.classList.remove("series__button--active")}))}window.addEventListener("keyup",(e=>{handleKey(e.key,keyHandlers)}));let game=null;const chooseButtons=document.querySelectorAll(".settings__video");function setVideo(){VIDEO.src="video/"+game+"/"+deepFlag+".webm",VIDEO.preload="auto"}function resetVideo(){VIDEO.pause(),VIDEO.removeAttribute("src"),VIDEO.removeAttribute("crossorigin"),statisticsName.classList.add("video__name--off"),WRAPPER.className="video__wrapper",START_BUTTON.classList.remove("video__start--hide"),CONTROLS.classList.add("control--off"),statisticsUFH.classList.add("header__ufh--off"),playButtonIcon.classList.add("control__icon--hide"),pauseButtonIcon.classList.remove("control__icon--hide"),stopProgress(),resetDuration()}function startVideo(){isVideoReadyToPlay()?handleVideoPlay():handleVideoError()}function isVideoReadyToPlay(){return VIDEO.hasAttribute("src")&&""!==VIDEO.src&&!VIDEO.error&&(VIDEO.readyState>=VIDEO.HAVE_CURRENT_DATA||VIDEO.readyState===HTMLMediaElement.HAVE_ENOUGH_DATA)}function handleVideoPlay(){openButton.classList.remove("header__menu--error"),START_BUTTON.classList.add("video__start--hide"),CONTROLS.classList.remove("control--off"),VIDEO.play(),VIDEO.focus(),getStatistics(),autoplayFlag&&VIDEO.addEventListener("loadeddata",startVideo)}function handleVideoError(){openButton.focus(),openButton.classList.add("header__menu--error"),setTimeout((()=>{openButton.classList.remove("header__menu--error")}),2e3),VIDEO.error&&showMessage(VIDEO.error.message)}let videoWidth,videoHeight,videoFormat,videoDuration,videoCurrentTime;chooseButtons.forEach((e=>{e.addEventListener("click",(function(){game=this.getAttribute("data-video"),setVideo(),deepCheckbox.removeAttribute("disabled","disabled")}))})),START_BUTTON.addEventListener("click",startVideo);let windowWidth=window.innerWidth,windowHeight=window.innerHeight;const statisticsName=document.querySelector(".video__name"),statisticsClientTime=STATISTICS.querySelector(".statistics__time"),statisticsEndTime=STATISTICS.querySelector(".statistics__end"),statisticsResolution=STATISTICS.querySelector(".statistics__resolution"),statisticsUFH=document.querySelector(".header__ufh"),statisticsFormat=STATISTICS.querySelector(".statistics__format"),statisticsDuration=STATISTICS.querySelector(".statistics__duration"),statisticsBuffer=STATISTICS.querySelector(".statistics__buffer");function getStatistics(){statisticsName.classList.remove("video__name--off"),videoWidth=VIDEO.videoWidth,videoHeight=VIDEO.videoHeight,videoDuration=Math.round(VIDEO.duration),VIDEO_RANGE.setAttribute("max",videoDuration),videoFormat=currentVideo.type?currentVideo.type.replace("video/",""):VIDEO.src.split(".").pop(),setStatistics()}function setStatistics(){statisticsName.innerHTML=currentVideo.name,statisticsResolution.innerHTML=videoWidth+"x"+videoHeight,statisticsFormat.innerHTML=videoFormat,statisticsDuration.innerHTML=videoDuration,videoWidth>=3840?statisticsUFH.classList.remove("header__ufh--off"):statisticsUFH.classList.add("header__ufh--off")}function updateBuffered(){VIDEO.buffered.length>0&&(videoBuffer=Math.floor(VIDEO.buffered.end(0)),statisticsBuffer.innerHTML=videoBuffer)}function updateCurrentTime(){videoCurrentTime=Math.floor(VIDEO.currentTime)}function getTime(){const e=new Date,t=e.getHours(),o=e.getMinutes();statisticsClientTime.innerHTML=t+":"+o}function getEndTime(){const e=new Date;e.setSeconds(e.getSeconds()+videoDuration);const t=e.getHours(),o=e.getMinutes();statisticsEndTime.innerHTML=t+":"+o}VIDEO.addEventListener("timeupdate",updateCurrentTime),VIDEO.addEventListener("progress",updateBuffered);const subtitles=document.querySelectorAll(".video__subtitle"),subtitlesTrack=VIDEO.textTracks,subtitleButton=CONTROLS.querySelector(".control__button--subtitle"),subtitleInfo=subtitleButton.querySelector(".control__info");let currentSubtitleIndex=-1;function setSubtitle(){if(0!==subtitles.length)if(currentSubtitleIndex++,currentSubtitleIndex>=subtitles.length&&(currentSubtitleIndex=-1),-1===currentSubtitleIndex)disableSubtitle();else{enableSubtitle(subtitles[currentSubtitleIndex])}}function enableSubtitle(e){e.track.mode="showing",e.mode="showing",e.default=!0,disableOtherSubtitles(e),subtitleButton.setAttribute("aria-label","Вимкнути субтитри"),subtitleButton.setAttribute("title","Вимкнути субтитри (c)"),subtitleButton.classList.add("control__button--active"),subtitleInfo.classList.remove("control__info--hide"),subtitleInfo.innerHTML=e.srclang}function disableSubtitle(){for(const e of subtitles)e.track.mode="disabled",e.mode="disabled",e.default=!1;subtitleButton.setAttribute("aria-label","Увімкнути субтитри"),subtitleButton.setAttribute("title","Увімкнути субтитри (c)"),subtitleButton.classList.remove("control__button--active"),subtitleInfo.classList.add("control__info--hide")}function disableOtherSubtitles(e){for(const t of subtitles)t!==e&&(t.track.mode="disabled",t.mode="disabled",t.default=!1)}subtitleButton.addEventListener("click",setSubtitle);const tabButtons=SETTINGS.querySelectorAll(".settings__button"),tabs=SETTINGS.querySelectorAll(".settings__tab");function updateSettingsHeight(){let e=SETTINGS.querySelector(".settings__control").clientHeight;const t=SETTINGS.querySelector(".settings__wrapper");let o=t.clientHeight;const s=SETTINGS.querySelector(".settings__tab--active");let n=s.clientHeight;t.style.height=`calc(100vh - ${e}px - 90px)`,n>o?s.classList.add("settings__tab--scroll"):s.classList.remove("settings__tab--scroll")}function checkActiveTab(){if(settingsOpen){"scheme"===SETTINGS.querySelector(".settings__tab--active").getAttribute("data-tab")?schemeSwitcher.classList.add("footer__switcher--show"):schemeSwitcher.classList.remove("footer__switcher--show")}else schemeSwitcher.classList.remove("footer__switcher--show")}let progressInterval,playbackQuality,currentVideoPassed,currentVideoLeft;tabButtons.forEach((e=>{e.addEventListener("click",(()=>{tabButtons.forEach((e=>e.classList.remove("settings__button--active"))),tabs.forEach((e=>{e.classList.remove("settings__tab--active"),e.classList.remove("settings__tab--scroll"),e.removeAttribute("tabIndex")})),e.classList.add("settings__button--active");const t=e.getAttribute("data-tab");document.querySelector(`.settings__tab[data-tab="${t}"]`).classList.add("settings__tab--active"),document.querySelector(`.settings__tab[data-tab="${t}"]`).setAttribute("tabIndex","0"),document.querySelector(`.settings__tab[data-tab="${t}"]`).focus(),checkActiveTab(),updateSettingsHeight()}))})),updateSettingsHeight(),window.addEventListener("resize",updateSettingsHeight);let isVideoPlaying=!1;function startProgress(){progressInterval=setTimeout(updateProgress,1e3),isVideoPlaying=!0}function updateProgress(){videoBuffer=Math.round(VIDEO.buffered.end(0)),statisticsBuffer.innerHTML=videoBuffer,videoCurrentTime=Math.round(VIDEO.currentTime),VIDEO_RANGE.value=videoCurrentTime,currentVideoPassed=formatTime(videoCurrentTime),currentVideoLeft=formatTime(videoDuration-videoCurrentTime),videoPassed.innerHTML=currentVideoPassed,videoLeft.innerHTML=currentVideoLeft,startProgress(),getTime(),getEndTime(),extraLine()}function stopProgress(){clearTimeout(progressInterval),isVideoPlaying=!1}function waitingVideo(){WRAPPER.classList.remove("video__wrapper--pause"),WRAPPER.classList.add("video__wrapper--waiting")}function playingVideo(){WRAPPER.classList.remove("video__wrapper--waiting")}function errorVideo(){WRAPPER.classList.add("video__wrapper--error"),showMessage("Помилка відео &#128528;"),isVideoPlaying=!1,resetVideo()}function removeErrorVideo(){WRAPPER.classList.remove("video__wrapper--error")}function pauseAnimation(){WRAPPER.classList.add("video__wrapper--pause")}function removePauseAnimation(){WRAPPER.classList.remove("video__wrapper--pause")}VIDEO.addEventListener("play",startProgress),VIDEO.addEventListener("pause",stopProgress),VIDEO.addEventListener("ended",stopProgress),VIDEO.addEventListener("waiting",waitingVideo),VIDEO.addEventListener("playing",playingVideo),VIDEO.addEventListener("error",errorVideo),VIDEO.addEventListener("loadeddata",removeErrorVideo),VIDEO.addEventListener("pause",pauseAnimation),VIDEO.addEventListener("playing",removePauseAnimation),VIDEO.addEventListener("ended",removePauseAnimation);