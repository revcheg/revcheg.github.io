const BODY=document.querySelector(".body"),HEADER=document.querySelector(".header"),FOOTER=document.querySelector(".footer"),MAIN=document.querySelector(".main"),VIDEO=document.querySelector(".video"),WRAPPER=document.querySelector(".video__wrapper"),SETTINGS=document.querySelector(".settings"),STATISTIC=document.querySelector(".statistic"),SERIES_LIST=document.querySelector(".series"),VIDEO_RANGE=document.querySelector(".control__range--duration"),START_BUTTON=document.querySelector(".video__start"),CONTROLS=document.querySelector(".control"),MESSAGE=document.querySelector(".message");let settingsOpen=!1;const openButton=document.querySelector(".header__menu"),closeButton=SETTINGS.querySelector(".settings__close");function openSettings(){settingsOpen?(settingsOpen=!1,SETTINGS.classList.add("settings--hide"),SETTINGS.blur()):(settingsOpen=!0,SETTINGS.classList.remove("settings--hide"),SETTINGS.focus()),"scheme"===categoryName&&schemeSwitcher.classList.add("footer__switcher--show")}function closeSettings(){settingsOpen=!1,SETTINGS.classList.add("settings--hide"),SETTINGS.blur(),schemeSwitcher.classList.remove("footer__switcher--show")}openButton.addEventListener("click",openSettings),closeButton.addEventListener("click",closeSettings);const statisticCheckbox=SETTINGS.querySelector(".settings__checkbox--statistic");function showStatistic(){STATISTIC.classList.toggle("statistic--off"),statisticName.classList.toggle("video__name--short")}statisticCheckbox.addEventListener("change",showStatistic);const scaleCheckbox=SETTINGS.querySelector(".settings__checkbox--scale");function setupScale(){scaleCheckbox.checked?BODY.addEventListener("mousemove",setScale):(WRAPPER.removeAttribute("style"),BODY.removeEventListener("mousemove",setScale))}function setScale(e){if(scaleCheckbox.checked&&e.isTrusted){let t=-40*-(e.pageX/window.innerWidth-.5),o=-40*(e.pageY/window.innerHeight-.5),n=VIDEO.getBoundingClientRect(),s=e.clientX-n.left,i=e.clientY-n.top;s>=0&&s<n.width&&i>=0&&i<n.height?WRAPPER.style.transform="perspective(1000px) rotateY(0deg) rotateX(0deg) scaleZ(1)":WRAPPER.style.transform="perspective(1000px) rotateY("+t+"deg) rotateX("+o+"deg) scaleZ(2)"}}scaleCheckbox.addEventListener("change",setupScale);let autoplayFlag=!0;const autoplayCheckbox=SETTINGS.querySelector(".settings__checkbox--autoplay");function setAutoplay(){autoplayCheckbox.checked?(autoplayFlag=!0,VIDEO.addEventListener("loadeddata",startVideo)):(autoplayFlag=!1,VIDEO.removeEventListener("loadeddata",startVideo))}autoplayCheckbox.addEventListener("change",setAutoplay);let deepFlag="main";const deepCheckbox=SETTINGS.querySelector(".settings__checkbox--deep"),deepLabel=deepCheckbox.parentNode;let playbackValue;deepCheckbox.addEventListener("change",(function(e){deepFlag=e.currentTarget.checked?"deep":"main",setVideo()}));const playbackProgress=CONTROLS.querySelector(".control__progress"),playbackCheckbox=SETTINGS.querySelector(".settings__checkbox--line");function updatePayback(){playbackCheckbox.checked&&(playbackValue=Math.floor(videoCurrentTime/videoDuration*100),playbackProgress.style.width=`calc(${playbackValue}% - 10px)`,playbackProgress.value=playbackValue)}function showPayback(){playbackProgress.classList.toggle("control__progress--hide")}playbackCheckbox.addEventListener("change",showPayback);const controlsCheckbox=SETTINGS.querySelector(".settings__checkbox--controls"),additionalControls=CONTROLS.querySelectorAll(".control__button--hide");function showAddControls(){controlsCheckbox.checked=!controlsCheckbox.checked,additionalControls.forEach((e=>{controlsCheckbox.checked?e.classList.remove("control__button--hide"):e.classList.add("control__button--hide")}))}controlsCheckbox.addEventListener("change",showAddControls),controlsCheckbox.addEventListener("click",showAddControls);const subtitleCheckbox=SETTINGS.querySelector(".settings__checkbox--subtitle");function setBackgroundSubtitle(){subtitleCheckbox.checked?VIDEO.classList.add("video--subtitle"):VIDEO.classList.remove("video--subtitle")}subtitleCheckbox.addEventListener("change",setBackgroundSubtitle);const subtitleBoldCheckbox=SETTINGS.querySelector(".settings__checkbox--bold");function setBolderSubtitle(){subtitleBoldCheckbox.checked?VIDEO.classList.add("video--bold"):VIDEO.classList.remove("video--bold")}subtitleBoldCheckbox.addEventListener("change",setBolderSubtitle);const blurCheckbox=SETTINGS.querySelector(".settings__checkbox--blur");blurCheckbox.addEventListener("change",(function(e){e.currentTarget.checked?BODY.classList.add("blur"):BODY.classList.remove("blur")}));let backgroundFlag=!1;const backgroundCheckbox=SETTINGS.querySelector(".settings__checkbox--background");function showBackground(){backgroundCheckbox.checked?(backgroundFlag=!0,background.classList.remove("background--off"),renderBackground()):(backgroundFlag=!1,background.classList.add("background--off"))}backgroundCheckbox.addEventListener("change",showBackground);const seriesCheckbox=SETTINGS.querySelector(".settings__checkbox--series"),seriesLabel=SETTINGS.querySelector(".settings__option--series");function showSeriesList(){seriesCheckbox.checked?SERIES_LIST.classList.remove("series--off"):SERIES_LIST.classList.add("series--off")}seriesCheckbox.addEventListener("change",showSeriesList);const schemeSwitcher=FOOTER.querySelector(".footer__switcher"),lightStyle=document.querySelector("link[rel=stylesheet][media*=prefers-color-scheme][media*=light]"),darkStyle=document.querySelector("link[rel=stylesheet][media*=prefers-color-scheme][media*=dark]");let systemScheme=getSystemScheme(),savedScheme=getSavedScheme(),lightMedia,darkMedia,schemeMedia,schemeStyle;function getSystemScheme(){return matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function setupScheme(){null!==savedScheme&&("light"===savedScheme?switchMedia("light"):"dark"===savedScheme?switchMedia("dark"):"vice"===savedScheme&&createScheme("vice"))}function setScheme(e){saveScheme(e),switchMedia(e),updateSchemeButtons(document.querySelector(`.footer__scheme[value=${e}]`))}function updateSchemeButtons(e){[...document.querySelectorAll(".footer__scheme")].forEach((t=>{t===e?(t.checked=!0,t.setAttribute("checked","checked")):(t.checked=!1,t.removeAttribute("checked"))}))}function switchMedia(e){"light"===e?(lightMedia="all",darkMedia="not all",schemeMedia="not all"):"dark"===e?(lightMedia="not all",darkMedia="all",schemeMedia="not all"):(lightMedia="not all",darkMedia="not all",schemeMedia="all"),lightStyle.media=lightMedia,darkStyle.media=darkMedia,schemeStyle&&(schemeStyle.media=schemeMedia)}function createScheme(e){if(document.querySelector(`link[href="css/${e}.css"]`))return;schemeStyle=document.createElement("link"),schemeStyle.setAttribute("rel","stylesheet"),schemeStyle.href=`css/${e}.css`,darkStyle.parentNode.insertBefore(schemeStyle,darkStyle.nextSibling),switchMedia(e);let t=document.createElement("label");t.classList.add("footer__label");let o=document.createElement("input");o.classList.add("button","footer__scheme"),o.name="color-scheme",o.ariaLabel=`${e}`,o.title=`Встановити ${e} тему`,o.type="radio",o.value=e;let n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.setAttribute("class","footer__icon"),n.setAttribute("xmlns","http://www.w3.org/2000/svg"),n.setAttribute("width","25"),n.setAttribute("height","25"),n.setAttribute("viewBox","0 0 48 48");let s=document.createElementNS("http://www.w3.org/2000/svg","use");s.setAttribute("href",`img/sprite.svg#${e}`),schemeSwitcher.appendChild(t),n.appendChild(s),t.appendChild(n),t.appendChild(o),updateSchemeButtons(o),saveScheme(e)}setupScheme(),updateSchemeButtons(null!==savedScheme?document.querySelector(`.footer__scheme[value=${savedScheme}]`):document.querySelector(`.footer__scheme[value=${systemScheme}]`)),schemeSwitcher.addEventListener("change",(e=>{savedScheme=e.target.value,setScheme(savedScheme)}));const background=document.querySelector(".background"),backgroundVideo=background.querySelector(".background__video"),backgroundContext=backgroundVideo.getContext("2d");function renderBackground(){backgroundFlag&&(backgroundContext.drawImage(VIDEO,0,0,backgroundVideo.width,backgroundVideo.height),setTimeout(renderBackground,1e3/30))}VIDEO.addEventListener("play",renderBackground);const consoleContainer=document.querySelector(".console"),consoleBackground=consoleContainer.querySelector(".console__background"),consoleClose=consoleContainer.querySelector(".console__close"),consoleInput=consoleContainer.querySelector(".console__input");function openConsole(){consoleBackground.src||(consoleBackground.src="video/console.mp4"),consoleBackground.play(),consoleContainer.classList.remove("console--hide"),consoleInput.focus()}function closeConsole(){consoleBackground.pause(),consoleContainer.classList.add("console--hide"),consoleInput.value="",consoleInput.blur()}consoleClose.addEventListener("click",closeConsole);const devButton=FOOTER.querySelector(".footer__copyright--dev"),MAX_DEV_CLICK=10;let clickCount=0;function devClicks(){++clickCount>=MAX_DEV_CLICK?(clickCount=0,openConsole(),showMessage("Консоль розробника розблокована &#129323;")):showMessage(`Залишилось ${MAX_DEV_CLICK-clickCount} кліків`)}devButton.addEventListener("click",devClicks);const consoleCommands={"unlimited spider man":{currentCategory:"bonus",currentSubcategory:"Unlimited Spider Man",message:"Відкрито бонусне відео &#128375;"},"spider man":{currentCategory:"bonus",currentSubcategory:"Spider Man",message:"Відкрито бонусне відео &#128375;"},"vice city":{currentCategory:"bonus",currentSubcategory:"Vice City",message:"Розблокована нова тема &#127847;",scheme:"vice"},"assassins creed 2":{currentCategory:"bonus",currentSubcategory:"Assassins Creed 2",message:"Відкрито бонусне відео &#129413;"},tmnt:{currentCategory:"bonus",currentSubcategory:"TMNT",message:"Кавабанга &#127829;"}};function executeCommand(e){if("Enter"===e.key){let e=consoleInput.value.trim().toLowerCase(),t=consoleCommands[e];t?(deepLabel.classList.add("settings__option--hide"),currentCategory=t.currentCategory,currentSubcategory=t.currentSubcategory,currentVideo=data[currentCategory][currentSubcategory][currentVideoIndex],resetVideo(),setupCurrentVideo(),closeConsole(),showMessage(t.message),autoplayFlag&&startVideo(),t.scheme&&createScheme(t.scheme)):showMessage("Команда неможлива &#128126;"),consoleInput.value="",consoleInput.blur()}}function stopPropagation(e){e.stopPropagation()}consoleInput.addEventListener("input",stopPropagation),consoleInput.addEventListener("keyup",stopPropagation),consoleInput.addEventListener("keyup",executeCommand);const devConsoleCheckbox=consoleContainer.querySelector(".console__input--checkbox");function executeDevCommand(event){if("Enter"===event.key&&!event.shiftKey){let command=consoleInput.value;try{let result=eval(command);showMessage("Результат: "+result)}catch(e){showMessage("Помилка: "+e.message)}consoleInput.value="",consoleInput.blur()}}function activateDevConsole(){devConsoleCheckbox.checked?(consoleInput.removeEventListener("keyup",executeCommand),consoleInput.addEventListener("keyup",executeDevCommand)):(consoleInput.removeEventListener("keyup",executeDevCommand),consoleInput.addEventListener("keyup",executeCommand))}devConsoleCheckbox.addEventListener("change",activateDevConsole),VIDEO.controls=!1;const playButton=CONTROLS.querySelector(".control__button--play"),playButtonIcon=CONTROLS.querySelector(".control__icon--play"),pauseButtonIcon=CONTROLS.querySelector(".control__icon--pause");function pauseVideo(){isVideoPlaying&&(VIDEO.pause(),isVideoPlaying=!1)}function playVideo(){isVideoPlaying||(VIDEO.play(),isVideoPlaying=!0)}function setPauseIcon(){playButtonIcon.classList.remove("control__icon--hide"),pauseButtonIcon.classList.add("control__icon--hide")}function setPlayIcon(){playButtonIcon.classList.add("control__icon--hide"),pauseButtonIcon.classList.remove("control__icon--hide")}function switchVideoState(){isVideoPlaying?pauseVideo():playVideo()}VIDEO.addEventListener("pause",setPauseIcon),VIDEO.addEventListener("playing",setPlayIcon),playButton.addEventListener("click",switchVideoState);const videoPassed=CONTROLS.querySelector(".control__time--passed"),videoLeft=CONTROLS.querySelector(".control__time--left");function setDuration(){let e=VIDEO_RANGE.value;VIDEO.currentTime=e,videoPassed.innerText=formatTime(e),videoLeft.innerText=formatTime(videoDuration-e),playbackProgress.value=e,playbackProgress.style.width=Math.floor(e/videoDuration*100)+"%"}function resetDuration(){VIDEO_RANGE.value="0",videoPassed.innerText=formatTime(0),videoLeft.innerText=formatTime(0),playbackProgress.style.width="0%",playbackProgress.value=0}function formatTime(e){let t=Math.floor(e/3600),o=Math.floor((e-3600*t)/60),n=Math.floor(e-3600*t-60*o);return t=t<10?"0"+t:t,o=o<10?"0"+o:o,n=n<10?"0"+n:n,parseInt(t)>0?t+":"+o+":"+n:o+":"+n}VIDEO_RANGE.addEventListener("input",setDuration);const videoPreview=CONTROLS.querySelector(".control__time--preview");function handleTimePreview(e){let t=e.touches?e.touches[0]:null,o=t?t.clientX:e.clientX,n=VIDEO_RANGE.getBoundingClientRect();"touchstart"===e.type||"touchmove"===e.type||"mousemove"===e.type?o<n.left||o>n.right?hideTimePreview():(showTimePreview(o),updatePreviewPosition(o)):"touchend"!==e.type&&"mouseleave"!==e.type||hideTimePreview()}function showTimePreview(e){let t=(e-VIDEO_RANGE.getBoundingClientRect().left)/VIDEO_RANGE.clientWidth*VIDEO_RANGE.max;videoPreview.classList.remove("control__time--hide"),videoPreview.innerText=formatTime(t)}function hideTimePreview(){videoPreview.classList.add("control__time--hide")}function updatePreviewPosition(e){let t=videoPreview.clientWidth,o=CONTROLS.querySelector(".control__duration").getBoundingClientRect(),n=e-o.left-t/2;n=Math.max(0,Math.min(n,o.width-t)),videoPreview.style.left=`${n}px`}function wheelDuration(e){e.preventDefault();const t=-Math.sign(e.deltaY);let o=parseFloat(VIDEO_RANGE.value)+t;VIDEO_RANGE.value=o,VIDEO.currentTime=VIDEO_RANGE.value,setDuration()}VIDEO_RANGE.addEventListener("touchmove",handleTimePreview),VIDEO_RANGE.addEventListener("touchend",hideTimePreview),VIDEO_RANGE.addEventListener("mousemove",handleTimePreview),VIDEO_RANGE.addEventListener("mouseleave",hideTimePreview),VIDEO_RANGE.addEventListener("wheel",wheelDuration);const muteButton=CONTROLS.querySelector(".control__button--mute"),muteButtonIcon=CONTROLS.querySelector("#muted");let savedVolume;function setupMute(){VIDEO.muted?unmuteVideo():muteVideo(),changeMuteIcon()}function muteVideo(){savedVolume=VIDEO.volume,VIDEO.muted=!0,VIDEO.volume=0,volumeRange.value=0}function unmuteVideo(){VIDEO.muted=!1,VIDEO.volume=savedVolume||.4,volumeRange.value=savedVolume}function changeMuteIcon(){const e=VIDEO.muted;muteButtonIcon.classList.toggle("control__icon--unmuted",!e),muteButtonIcon.classList.toggle("control__icon--muted",e),muteButton.classList.toggle("control__button--active",e)}muteButton.addEventListener("click",setupMute),VIDEO.volume=.4;const volumeRange=CONTROLS.querySelector(".control__range--volume");function changeVolume(e){let t=Math.max(0,Math.min(1,VIDEO.volume+e));VIDEO.volume=t,volumeRange.value=t,updateVolume()}function updateVolume(){VIDEO.volume=volumeRange.value,0===VIDEO.volume?VIDEO.muted=!0:VIDEO.muted=!1,changeMuteIcon()}function formatVolume(e){return(100*e).toFixed(0)+"%"}function showVolume(){showMessage("Гучність "+formatVolume(VIDEO.volume))}function wheelVolume(e){if(e.preventDefault(),void 0!==e.deltaY&&!isNaN(e.deltaY)){changeVolume(.1*-Math.sign(e.deltaY))}}volumeRange.addEventListener("input",updateVolume),VIDEO.addEventListener("volumechange",showVolume),volumeRange.addEventListener("wheel",wheelVolume),VIDEO.addEventListener("wheel",wheelVolume);let videoSpeed=1;const SPEED_STEP=.25,MIN_SPEED=.25,MAX_SPEED=2,speedButton=CONTROLS.querySelector(".control__button--speed"),speedInfo=speedButton.querySelector(".control__info");function changeSpeed(){videoSpeed+=SPEED_STEP,videoSpeed>MAX_SPEED&&(videoSpeed=MIN_SPEED),VIDEO.playbackRate=videoSpeed,speedInfo.classList.remove("control__info--hide"),speedInfo.innerText=videoSpeed+"x",1!==videoSpeed?speedButton.classList.add("control__button--active"):(speedButton.classList.remove("control__button--active"),speedInfo.classList.add("control__info--hide"))}function resetSpeed(){videoSpeed=1,speedButton.classList.remove("control__button--active"),speedInfo.classList.add("control__info--hide")}speedButton.addEventListener("click",changeSpeed);const pipButton=CONTROLS.querySelector(".control__button--pip");function setPictureInPicture(){document.pictureInPictureElement?(VIDEO.setAttribute("disablePictureInPicture","disablePictureInPicture"),exitPictureInPicture()):(VIDEO.removeAttribute("disablePictureInPicture"),enterPictureInPicture())}function enterPictureInPicture(){VIDEO.requestPictureInPicture().then((()=>{pipButton.classList.add("control__button--active"),updatePipButtonAttributes("Закрити міні-програвач","Закрити міні-програвач (p)")})).catch((e=>{console.error(e)}))}function exitPictureInPicture(){document.pictureInPictureElement&&document.exitPictureInPicture().then((()=>{pipButton.classList.remove("control__button--active"),updatePipButtonAttributes("Міні-програвач","Міні-програвач (p)")})).catch((e=>{console.error(e)}))}function updatePipButtonAttributes(e,t){pipButton.setAttribute("aria-label",e),pipButton.setAttribute("title",t)}pipButton.addEventListener("click",setPictureInPicture),document.addEventListener("leavepictureinpicture",exitPictureInPicture);const fitButton=CONTROLS.querySelector(".control__button--fit"),fitInfo=fitButton.querySelector(".control__info");function switchFitScreen(){let e="cover"===VIDEO.style.objectFit?"contain":"cover";VIDEO.style.objectFit=e,fitButton.classList.toggle("control__button--active"),"contain"===e?(fitButton.setAttribute("aria-label","Ростягнути зображення"),fitButton.setAttribute("title","Ростягнути зображення (x)"),fitInfo.classList.add("control__info--hide")):(fitButton.setAttribute("aria-label","Зменшити зображення"),fitButton.setAttribute("title","Зменшити зображення (x)"),fitInfo.classList.remove("control__info--hide"))}fitButton.addEventListener("click",switchFitScreen);let cinemaFlag=!1;const cinemaButton=CONTROLS.querySelector(".control__button--cinema");function enterCinemaMode(){HEADER.classList.add("header--hide"),FOOTER.classList.add("footer--hide"),SERIES_LIST.classList.add("series--off"),BODY.style.overflow="hidden",setTimeout((()=>{HEADER.style.display="none",FOOTER.style.display="none",WRAPPER.classList.add("video__wrapper--cinema"),MAIN.classList.add("main--cinema"),VIDEO.focus()}),250)}function exitCinemaMode(){seriesCheckbox.checked&&SERIES_LIST.classList.remove("series--off"),HEADER.style.display="flex",FOOTER.style.display="flex",WRAPPER.classList.remove("video__wrapper--cinema"),MAIN.classList.remove("main--cinema"),VIDEO.blur(),BODY.removeAttribute("style"),setTimeout((()=>{HEADER.classList.remove("header--hide"),FOOTER.classList.remove("footer--hide")}),250)}function setCinemaMode(){cinemaFlag=!cinemaFlag,cinemaButton.classList.toggle("control__button--active"),cinemaFlag?(cinemaButton.setAttribute("aria-label","Вийти з режиму кінотеатра"),cinemaButton.setAttribute("title","Вийти з режиму кінотеатра (t)"),enterCinemaMode()):(cinemaButton.setAttribute("aria-label","Режим кінотеатру"),cinemaButton.setAttribute("title","Режим кінотеатру (t)"),exitCinemaMode())}BODY.clientWidth>1024&&cinemaButton.classList.remove("control__button--off"),cinemaButton.addEventListener("click",setCinemaMode);const fullButton=CONTROLS.querySelector(".control__button--size"),fullButtonSize=CONTROLS.querySelector(".control__icon--size"),fullButtonMin=CONTROLS.querySelector(".control__icon--min");function setFullscreen(){document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement?document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen&&document.mozCancelFullScreen():WRAPPER.requestFullscreen?WRAPPER.requestFullscreen():WRAPPER.mozRequestFullScreen&&WRAPPER.mozRequestFullScreen()}function updateFullscreenButton(){const e=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement;fullButton.setAttribute("aria-label",e?"Закрити повний екран":"На весь екран"),fullButton.setAttribute("title",e?"Закрити повний екран (esc)":"На весь екран (f)"),fullButtonSize.classList.toggle("control__icon--hide",e),fullButtonMin.classList.toggle("control__icon--hide",!e)}let hideControlsTimer;function handleMouseMove(){clearTimeout(hideControlsTimer),showControls(),hideControlsTimer=setTimeout((()=>{hideControls()}),5e3)}function showControls(){statisticName.classList.remove("video__name--hide"),VIDEO.style.cursor="auto",STATISTIC.classList.remove("statistic--hide"),CONTROLS.classList.remove("control--hide")}function hideControls(){statisticName.classList.add("video__name--hide"),VIDEO.style.cursor="none",STATISTIC.classList.add("statistic--hide"),CONTROLS.classList.add("control--hide")}function resetHideControlsTimer(){clearTimeout(hideControlsTimer),hideControlsTimer=setTimeout((()=>{hideControls()}),5e3)}fullButton.addEventListener("click",setFullscreen),WRAPPER.addEventListener("dblclick",setFullscreen),document.addEventListener("fullscreenchange",updateFullscreenButton),document.addEventListener("webkitfullscreenchange",updateFullscreenButton),document.addEventListener("mozfullscreenchange",updateFullscreenButton),WRAPPER.addEventListener("touchstart",handleMouseMove),WRAPPER.addEventListener("touchmove",handleMouseMove),WRAPPER.addEventListener("touchend",resetHideControlsTimer),WRAPPER.addEventListener("mouseenter",resetHideControlsTimer),WRAPPER.addEventListener("mousemove",handleMouseMove),WRAPPER.addEventListener("mouseleave",hideControls);const MAX_FILE_SIZE=5368709120,INPUTFILE=SETTINGS.querySelector(".settings__file"),INPUTFILE_OUTPUT=SETTINGS.querySelector(".settings__output"),INPUTFILE_COUNTER=SETTINGS.querySelector(".settings__counter"),supportedFormats=["video/mp4","video/webm"];let uploadedVideo=[];function handleFiles(e){Array.from(e.target.files).forEach((e=>{const t=URL.createObjectURL(e);uploadedVideo.push({file:e,url:t,src:t,name:e.name,type:e.type,size:e.size})})),validateFiles(uploadedVideo),clearVideoButtons()}function validateFiles(e){let t=!0;if(e.forEach((e=>{let o=e.file.size,n=e.file.type;o>MAX_FILE_SIZE?(showMessage("Файл завеликий &#128548;"),t=!1):isSupportedFileType(n)||(showMessage("Непідтримуваний тип файлу &#128552;"),t=!1)})),t){e.length>1&&(INPUTFILE_COUNTER.innerText="+"+e.length,INPUTFILE_COUNTER.classList.remove("settings__counter--hide"),seriesLabel.classList.remove("settings__option--hide"));let t=e[e.length-1];INPUTFILE_OUTPUT.innerText=t.name,VIDEO.setAttribute("crossorigin","anonymous"),generatingSeries(),setupCurrentVideo(),showMessage("Кінострічка готова &#128252;")}INPUTFILE.value=""}function isSupportedFileType(e){return supportedFormats.includes(e)}INPUTFILE.addEventListener("change",resetVideo),INPUTFILE.addEventListener("change",handleFiles);let data=null,currentCategory="bonus",currentSubcategory="Assassins Creed 2",currentVideoIndex=0;fetch("video.json").then((e=>{if(!e.ok)throw showMessage("Помилка загрузки json &#128531;"),Error("Failed to load video.json");return e.json()})).then((e=>{data=e,setupCurrentVideo()})).catch((e=>{console.error("An error occurred:",e)}));let currentVideo=null;function setupCurrentVideo(){autoplayFlag||resetVideo(),currentVideo=uploadedVideo.length>0?uploadedVideo[currentVideoIndex]:data[currentCategory][currentSubcategory][currentVideoIndex],videoName=currentVideo.name,currentVideo.year&&(videoName+=" / "+currentVideo.year),statisticName.innerText=videoName,VIDEO.setAttribute("src",currentVideo.src),VIDEO.setAttribute("alt",currentVideo.description),VIDEO.preload="auto",currentVideo.subtitle?subtitleButton.classList.remove("control__button--off"):subtitleButton.classList.add("control__button--off")}const prevButton=CONTROLS.querySelector(".control__button--prev"),nextButton=CONTROLS.querySelector(".control__button--next");function changeVideoIndex(e){if(uploadedVideo.length>0)currentVideoIndex+=e,currentVideoIndex>=uploadedVideo.length?currentVideoIndex=0:currentVideoIndex<0&&(currentVideoIndex=uploadedVideo.length-1);else if(currentVideoIndex+=e,currentVideoIndex<0){const e=Object.keys(data[currentCategory]),t=e.indexOf(currentSubcategory);if(t>0)currentSubcategory=e[t-1],currentVideoIndex=data[currentCategory][currentSubcategory].length-1;else{const e=Object.keys(data),t=e.indexOf(currentCategory);if(t>0){currentCategory=e[t-1];const o=Object.keys(data[currentCategory]).pop();currentSubcategory=o,currentVideoIndex=data[currentCategory][o].length-1}else{currentCategory=e[e.length-1];const t=Object.keys(data[currentCategory]).pop();currentSubcategory=t,currentVideoIndex=data[currentCategory][t].length-1}}}else if(currentVideoIndex>=data[currentCategory][currentSubcategory].length){const e=Object.keys(data[currentCategory]),t=e.indexOf(currentSubcategory);if(t<e.length-1)currentSubcategory=e[t+1],currentVideoIndex=0;else{const e=Object.keys(data),t=e.indexOf(currentCategory);t<e.length-1?(currentCategory=e[t+1],currentSubcategory=Object.keys(data[currentCategory])[0],currentVideoIndex=0):(currentCategory=e[0],currentSubcategory=Object.keys(data[currentCategory])[0],currentVideoIndex=0)}}setupCurrentVideo()}nextButton.addEventListener("click",(()=>changeVideoIndex(1))),prevButton.addEventListener("click",(()=>changeVideoIndex(-1))),VIDEO.addEventListener("ended",(()=>changeVideoIndex(1)));const keyHandlers={playPause:" ",nextVideoIndex:".",prevVideoIndex:",",skipBackward:"ArrowLeft",skipForward:"ArrowRight",changeVolumeUp:"ArrowUp",changeVolumeDown:"ArrowDown",toggleMute:"m",setSubtitle:"c",changeSpeed:"s",openPIP:"p",toggleFitScreen:"x",toggleFullscreen:"f",showAddControls:"b",openSettings:"i",closeSettings:"Escape",startVideo:"k",setLightScheme:"l",setDarkScheme:"d",setCinemaMode:"t",openConsole:"`"};function handleKey(e,t){for(const o in t)if(t[o]===e){if(isVideoStarted)switch(o){case"playPause":switchVideoState();break;case"nextVideoIndex":changeVideoIndex(1);break;case"prevVideoIndex":changeVideoIndex(-1);break;case"skipBackward":VIDEO.currentTime-=5,VIDEO_RANGE.value=VIDEO.currentTime,setDuration();break;case"skipForward":VIDEO.currentTime+=5,VIDEO_RANGE.value=VIDEO.currentTime,setDuration();break;case"changeVolumeUp":changeVolume(.1);break;case"changeVolumeDown":changeVolume(-.1);break;case"toggleMute":setupMute();break;case"setSubtitle":setSubtitle();break;case"changeSpeed":changeSpeed();break;case"openPIP":setPictureInPicture();break;case"toggleFitScreen":switchFitScreen();break;case"toggleFullscreen":setFullscreen();break;case"showAddControls":showAddControls()}switch(o){case"openSettings":openSettings();break;case"closeSettings":closeSettings(),closeConsole();break;case"startVideo":startVideo();break;case"setLightScheme":setScheme("light");break;case"setDarkScheme":setScheme("dark");break;case"setCinemaMode":setCinemaMode();break;case"openConsole":openConsole()}}}function saveScheme(e){localStorage.setItem("selected-scheme",e)}function getSavedScheme(){return localStorage.getItem("selected-scheme")}let messageTimeout;window.addEventListener("keyup",(e=>{handleKey(e.key,keyHandlers)}));let isMessageVisible=!1;function showMessage(e,t=3e3){messageTimeout&&clearTimeout(messageTimeout),MESSAGE.classList.remove("message--hide"),MESSAGE.innerHTML=e,MESSAGE.classList.contains("message--animate")||MESSAGE.classList.add("message--animate"),messageTimeout=setTimeout((()=>{clearMessage(),isMessageVisible=!1}),t)}function clearMessage(){MESSAGE.classList.remove("message--animate"),MESSAGE.classList.add("message--hide")}function generatingSeries(){SERIES_LIST.innerText="",Array.from(uploadedVideo).forEach(((e,t)=>{const o=document.createElement("li");o.className="series__item";const n=document.createElement("button");n.className="button series__button",n.type="button",n.textContent=e.name,o.appendChild(n),SERIES_LIST.appendChild(o),n.addEventListener("click",(()=>{setActiveButton(n),currentVideoIndex=t,VIDEO.src=e.url}))}))}function setActiveButton(e){SERIES_LIST.querySelectorAll(".series__button").forEach((e=>{e.classList.remove("series__button--active")})),e.classList.add("series__button--active")}function updateActiveButton(){SERIES_LIST.querySelectorAll(".series__button").forEach(((e,t)=>{t===currentVideoIndex?e.classList.add("series__button--active"):e.classList.remove("series__button--active")}))}MESSAGE.addEventListener("mouseover",(()=>{isMessageVisible||(isMessageVisible=!0),messageTimeout&&clearTimeout(messageTimeout)})),MESSAGE.addEventListener("mouseout",(()=>{isMessageVisible&&(messageTimeout=setTimeout((()=>{clearMessage(),isMessageVisible=!1}),3e3))}));let game=null;const chooseButtons=SETTINGS.querySelectorAll(".settings__video");function selectGame(){clearVideoButtons(),"Custom"!=this.getAttribute("data-video")&&(this.classList.add("settings__video--active"),game=this.getAttribute("data-video"),currentCategory=game,currentVideo=data[currentCategory],currentVideo.deep?(deepLabel.classList.remove("settings__option--hide"),showMessage("Доступна deep категорія")):deepLabel.classList.add("settings__option--hide"),setVideo())}function setVideo(){currentCategory=game,currentSubcategory=deepFlag,currentVideo=data[currentCategory][currentSubcategory][currentVideoIndex],setupCurrentVideo()}function clearVideoButtons(){chooseButtons.forEach((e=>{e.classList.remove("settings__video--active")}))}function resetVideo(){isVideoStarted=!1,stopProgress(),resetDuration(),VIDEO.src="",VIDEO.removeAttribute("src"),VIDEO.removeAttribute("preload"),VIDEO.removeAttribute("crossorigin"),statisticUFH.classList.add("header__ufh--off"),WRAPPER.className="video__wrapper",START_BUTTON.classList.remove("video__start--hide"),statisticName.classList.add("video__name--off"),CONTROLS.classList.add("control--off"),playButtonIcon.classList.add("control__icon--hide"),pauseButtonIcon.classList.remove("control__icon--hide")}function setupStart(){isVideoReadyToPlay()?startVideo():emptyError()}function isVideoReadyToPlay(){return VIDEO.hasAttribute("src")&&""!==VIDEO.src&&!VIDEO.error&&(VIDEO.readyState>=VIDEO.HAVE_CURRENT_DATA||VIDEO.readyState===HTMLMediaElement.HAVE_ENOUGH_DATA)}chooseButtons.forEach((e=>{e.addEventListener("click",selectGame)}));let isVideoStarted=!1,videoName,videoWidth,videoHeight,videoFormat,videoDuration,videoCurrentTime;function startVideo(){isVideoStarted=!0,START_BUTTON.classList.add("video__start--hide"),CONTROLS.classList.remove("control--off"),statisticName.classList.remove("video__name--off"),setAutoplay(),playVideo()}function emptyError(){openButton.focus(),openButton.classList.add("header__menu--error"),setTimeout((()=>{openButton.classList.remove("header__menu--error")}),2100),VIDEO.error&&showMessage(VIDEO.error.message),showMessage("Відео відсутнє, спробуйте обрати інше"),setSettingsCategory("video")}START_BUTTON.addEventListener("click",startVideo);const statisticName=WRAPPER.querySelector(".video__name"),statisticClientTime=STATISTIC.querySelector(".statistic__time"),statisticEndTime=STATISTIC.querySelector(".statistic__end"),statisticResolution=STATISTIC.querySelector(".statistic__resolution"),statisticUFH=HEADER.querySelector(".header__ufh"),statisticFormat=STATISTIC.querySelector(".statistic__format"),statisticBuffer=STATISTIC.querySelector(".statistic__buffer");function getStatistic(){videoWidth=VIDEO.videoWidth,videoHeight=VIDEO.videoHeight,statisticResolution.innerText=videoWidth+"x"+videoHeight,videoDuration=VIDEO.duration,VIDEO_RANGE.setAttribute("max",videoDuration),videoFormat=currentVideo.type?currentVideo.type.replace("video/",""):VIDEO.src.split(".").pop(),statisticFormat.innerText=videoFormat,videoWidth>=3840?statisticUFH.classList.remove("header__ufh--off"):statisticUFH.classList.add("header__ufh--off")}function updateClientTime(){let e=new Date,t=formatTimeUnit(e.getHours()),o=formatTimeUnit(e.getMinutes());statisticClientTime.innerText=t+":"+o;let n=new Date;n.setSeconds(n.getSeconds()+videoDuration);let s=formatTimeUnit(n.getHours()),i=formatTimeUnit(n.getMinutes());statisticEndTime.innerText=s+":"+i}function formatTimeUnit(e){return e<10?"0"+e:e}function saveVideoTime(){localStorage.setItem("video-category",currentCategory),localStorage.setItem("video-subcategory",currentSubcategory),localStorage.setItem("video-index",currentVideoIndex),localStorage.setItem("video-time",videoCurrentTime)}function loadVideoTime(){localStorage.getItem("video-time")&&(currentCategory=localStorage.getItem("video-category"),currentSubcategory=localStorage.getItem("video-subcategory"),currentVideoIndex=parseInt(localStorage.getItem("video-index")),videoCurrentTime=parseInt(localStorage.getItem("video-time")),VIDEO.currentTime=videoCurrentTime,showMessage("Відео та таймкоди було відновлено"))}function clearVideoTime(){localStorage.removeItem("video-category"),localStorage.removeItem("video-subcategory"),localStorage.removeItem("video-index"),localStorage.removeItem("video-time")}loadVideoTime(),VIDEO.addEventListener("timeupdate",saveVideoTime),VIDEO.addEventListener("ended",clearVideoTime);const subtitles=document.querySelectorAll(".video__subtitle"),subtitlesTrack=VIDEO.textTracks,subtitleButton=CONTROLS.querySelector(".control__button--subtitle"),subtitleInfo=subtitleButton.querySelector(".control__info");let currentSubtitleIndex=-1;function setSubtitle(){if(0!==subtitles.length)if(currentSubtitleIndex++,currentSubtitleIndex>=subtitles.length&&(currentSubtitleIndex=-1),-1===currentSubtitleIndex)disableSubtitle();else{enableSubtitle(subtitles[currentSubtitleIndex])}}function enableSubtitle(e){e.track.mode="showing",e.mode="showing",e.default=!0,disableOtherSubtitles(e),subtitleButton.setAttribute("aria-label","Вимкнути субтитри"),subtitleButton.setAttribute("title","Вимкнути субтитри (c)"),subtitleButton.classList.add("control__button--active"),subtitleInfo.classList.remove("control__info--hide"),subtitleInfo.innerText=e.srclang}function disableSubtitle(){for(const e of subtitles)e.track.mode="disabled",e.mode="disabled",e.default=!1;subtitleButton.setAttribute("aria-label","Увімкнути субтитри"),subtitleButton.setAttribute("title","Увімкнути субтитри (c)"),subtitleButton.classList.remove("control__button--active"),subtitleInfo.classList.add("control__info--hide")}function disableOtherSubtitles(e){for(const t of subtitles)t!==e&&(t.track.mode="disabled",t.mode="disabled",t.default=!1)}subtitleButton.addEventListener("click",setSubtitle);const settingsCategory=SETTINGS.querySelectorAll(".settings__tab"),settingsButtons=SETTINGS.querySelectorAll(".settings__button");let categoryName,progressInterval,currentVideoPassed,currentVideoLeft;function setSettingsCategory(e){settingsButtons.forEach((e=>e.classList.remove("settings__button--active"))),settingsCategory.forEach((e=>e.classList.remove("settings__tab--active"))),SETTINGS.querySelector(`[data-tab="${e}"]`).classList.add("settings__button--active");let t=SETTINGS.querySelector(`.settings__tab[data-tab="${e}"]`);t.classList.add("settings__tab--active"),t.focus(),"scheme"===e?schemeSwitcher.classList.add("footer__switcher--show"):schemeSwitcher.classList.remove("footer__switcher--show")}settingsButtons.forEach((e=>{e.addEventListener("click",(()=>{categoryName=e.getAttribute("data-tab"),setSettingsCategory(categoryName)}))}));let isVideoPlaying=!1;function startProgress(){isVideoPlaying=!0,progressInterval=setInterval(updateProgress,1e3),updateProgress()}function updateProgress(){videoBuffer=VIDEO.buffered.end(0)-videoCurrentTime,statisticBuffer.innerText=Math.floor(videoBuffer),videoCurrentTime=VIDEO.currentTime,VIDEO_RANGE.value=videoCurrentTime,currentVideoPassed=formatTime(videoCurrentTime),currentVideoLeft=formatTime(videoDuration-videoCurrentTime),videoPassed.innerText=currentVideoPassed,videoLeft.innerText=currentVideoLeft,updateClientTime(),updatePayback()}function stopProgress(){clearInterval(progressInterval),isVideoPlaying=!1}function loadstartState(){stopProgress(),resetDuration(),resetSpeed(),updateActiveButton(),WRAPPER.classList.add("video__wrapper--loadstart")}function removeLoadstartState(){WRAPPER.classList.remove("video__wrapper--loadstart")}function loadeddataState(){getStatistic()}function pauseState(){WRAPPER.classList.add("video__wrapper--pause")}function removePauseState(){WRAPPER.classList.remove("video__wrapper--pause")}function waitingState(){WRAPPER.classList.add("video__wrapper--waiting")}function removeWaitingState(){WRAPPER.classList.remove("video__wrapper--waiting")}function errorState(){WRAPPER.classList.add("video__wrapper--error"),showMessage("Помилка відео &#128528;"),isVideoPlaying=!1,resetVideo()}function removeErrorState(){WRAPPER.classList.remove("video__wrapper--error")}VIDEO.addEventListener("play",startProgress),VIDEO.addEventListener("pause",stopProgress),VIDEO.addEventListener("ended",stopProgress),VIDEO.addEventListener("loadstart",loadstartState),VIDEO.addEventListener("loadeddata",removeLoadstartState),VIDEO.addEventListener("loadeddata",loadeddataState),VIDEO.addEventListener("pause",pauseState),VIDEO.addEventListener("playing",removePauseState),VIDEO.addEventListener("waiting",waitingState),VIDEO.addEventListener("playing",removeWaitingState),VIDEO.addEventListener("error",errorState),VIDEO.addEventListener("canplay",removeErrorState);