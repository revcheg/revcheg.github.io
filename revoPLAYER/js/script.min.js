const BODY=document.querySelector(".body"),VIDEO=document.querySelector(".video"),WRAPPER=document.querySelector(".video__wrapper"),SETTINGS=document.querySelector(".settings"),STATISTICS=document.querySelector(".statistics"),VIDEORANGE=document.querySelector(".control__range--duration"),STARTBUTTON=document.querySelector(".video__start"),CONTROLS=document.querySelector(".control"),ERROR=document.querySelector(".error");VIDEO.controls=!1;const playButton=CONTROLS.querySelector(".control__button--play"),playButtonIcon=CONTROLS.querySelector(".control__icon--play"),pauseButtonIcon=CONTROLS.querySelector(".control__icon--pause");function pauseVideo(){VIDEO.paused?VIDEO.play():VIDEO.pause()}function changePauseIcon(){playButtonIcon.classList.toggle("control__icon--hide"),pauseButtonIcon.classList.toggle("control__icon--hide")}playButton.addEventListener("click",pauseVideo),playButton.addEventListener("click",changePauseIcon),VIDEO.addEventListener("click",pauseVideo),VIDEO.addEventListener("click",changePauseIcon);const muteButton=CONTROLS.querySelector(".control__button--mute"),muteButtonIcon=CONTROLS.querySelector(".control__mute");function muteVideo(){let e=VIDEO.volume;VIDEO.muted?(VIDEO.muted=!1,VIDEO.volume=e,volumeRange.value=VIDEO.volume,e<=0&&(VIDEO.volume=.5,volumeRange.value=.5)):(VIDEO.muted=!0,volumeRange.value="0")}function changeMuteIcon(){VIDEO.muted?muteButtonIcon.classList.remove("control__mute"):muteButtonIcon.classList.add("control__mute")}muteButton.addEventListener("click",muteVideo),muteButton.addEventListener("click",changeMuteIcon),VIDEO.volume=.5;const volumeRange=CONTROLS.querySelector(".control__range--volume");function changeVolume(e){let t=VIDEO.volume+e;t=Math.max(0,Math.min(1,t)),VIDEO.volume=t,volumeRange.value=t,updateVolume()}function updateVolume(){VIDEO.volume=volumeRange.value,0===VIDEO.volume?(VIDEO.muted=!0,changeMuteIcon()):(VIDEO.muted=!1,changeMuteIcon())}let lineProgress,rangeValue;function extraLine(){lineProgress=videoCurrentTime/videoDuration*100,line.style.width=lineProgress+"%",line.value=lineProgress}volumeRange.addEventListener("input",updateVolume),VIDEORANGE.addEventListener("mousedown",(()=>{VIDEO.pause(),stopProgress(),playButtonIcon.classList.contains("control__icon--hide")&&changePauseIcon()})),VIDEORANGE.addEventListener("change",(function(){rangeValue=VIDEORANGE.value,VIDEO.currentTime=rangeValue,VIDEO.play(),pauseButtonIcon.classList.contains("control__icon--hide")&&changePauseIcon()}));const fullButton=CONTROLS.querySelector(".control__button--size");function openFullscreen(){VIDEO.requestFullscreen?VIDEO.requestFullscreen():VIDEO.mozRequestFullScreen?VIDEO.mozRequestFullScreen():VIDEO.webkitRequestFullscreen?VIDEO.webkitRequestFullscreen():VIDEO.msRequestFullscreen&&VIDEO.msRequestFullscreen()}fullButton.addEventListener("click",openFullscreen);const errorText=ERROR.querySelector(".error__text");function showError(){ERROR.classList.remove("error--hide"),setTimeout((()=>{ERROR.classList.add("error--hide")}),2e3)}let FILE,FILETYPE,FILEURL,FILESIZE;const MAX_FILE_SIZE=5368709120,INPUTFILE=document.querySelector(".settings__file");function validateFILE(e){FILESIZE<5368709120?isSupportedFileType(e.type)?(VIDEO.src=FILEURL,VIDEO.setAttribute("crossorigin","anonymous")):(errorText.innerHTML="Непідтримуваний тип файлу",showError(),INPUTFILE.value=""):(errorText.innerHTML="Файл завеликий",showError(),INPUTFILE.value="")}function isSupportedFileType(e){return["video/mp4","video/webm"].includes(e)}let videoKey;function saveScheme(e){localStorage.setItem("localTheme",e),localStorage.setItem("localButton",buttonIndex)}function loadScheme(){if(localStorage){setScheme(localStorage.getItem("localTheme"));setButton(localStorage.getItem("localButton"))}}function getSavedScheme(){return localStorage.getItem("localTheme")}function clearScheme(){localStorage.removeItem("localTheme")}INPUTFILE.addEventListener("click",(function(){resetVideo()})),INPUTFILE.addEventListener("change",(function(){FILE=INPUTFILE.files[0],FILEURL=URL.createObjectURL(FILE),FILETYPE=INPUTFILE.files[0].type.replace("video/",""),FILESIZE=FILE.size,validateFILE(FILE)})),VIDEO.addEventListener("keyup",(e=>{switch(videoKey=e.key,videoKey){case" ":pauseVideo(),changePauseIcon();break;case"ArrowLeft":VIDEO.currentTime-=5;break;case"ArrowRight":VIDEO.currentTime+=5;break;case"ArrowUp":changeVolume(.1);break;case"ArrowDown":changeVolume(-.1);break;case"m":muteVideo(),changeMuteIcon();break;case"f":fullscreenVideo()}})),BODY.addEventListener("keyup",(e=>{switch(videoKey=e.key,videoKey){case"s":openSettings();break;case"Escape":closeSettings();break;case"p":startVideo();break;case"l":setScheme("light"),setButton(),saveScheme("light");break;case"d":setScheme("dark"),setButton(),saveScheme("dark")}}));let buttonIndex,scheme="light";const themeButtons=document.querySelectorAll(".footer__theme");function setButton(){themeButtons.forEach((e=>{e.removeAttribute("disabled"),e.classList.remove("footer__theme--active")})),themeButtons[buttonIndex].setAttribute("disabled","disabled"),themeButtons[buttonIndex].classList.add("footer__theme--active")}scheme=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",themeButtons.forEach((function(e,t){e.addEventListener("click",(function(){buttonIndex=Array.from(themeButtons).indexOf(e),scheme=this.getAttribute("data-theme"),setButton(buttonIndex),setScheme(scheme),saveScheme(scheme)}))}));let game,favicon=document.querySelector('link[href="img/favicons/favicon.svg"]');function setScheme(e){switch(BODY.className="",e){case"light":BODY.classList.add(e),buttonIndex=0,favicon.href="img/favicons/favicon.svg";break;case"dark":BODY.classList.add(e),buttonIndex=1,favicon.href="img/favicons/favicon-dark.svg";break;case"cyberpunk":BODY.classList.add(e),buttonIndex=2}}setScheme(scheme),setButton(buttonIndex),loadScheme();const chooseButtons=document.querySelectorAll(".settings__video");function setVideo(){VIDEO.src="video/"+game+"/"+deepFlag+".webm",VIDEO.preload="auto"}function resetVideo(){VIDEO.load(),VIDEO.removeAttribute("crossorigin"),WRAPPER.className="video__wrapper",STARTBUTTON.classList.remove("video__start--hide"),CONTROLS.classList.add("control--hide"),STATISTICS.classList.add("statistics--hide"),playButtonIcon.classList.add("control__icon--hide"),pauseButtonIcon.classList.remove("control__icon--hide"),resetDuration()}chooseButtons.forEach((e=>{e.addEventListener("click",(function(){game=this.getAttribute("data-video"),resetVideo(),setVideo(),deepCheckbox.removeAttribute("disabled","disabled")}))}));const openButton=document.querySelector(".header__menu"),closeButton=SETTINGS.querySelector(".settings__close");function openSettings(){SETTINGS.classList.remove("settings--hide"),SETTINGS.focus()}function closeSettings(){SETTINGS.classList.add("settings--hide"),SETTINGS.blur()}openButton.addEventListener("click",openSettings),closeButton.addEventListener("click",closeSettings);const statisticsCheckbox=SETTINGS.querySelector(".settings__checkbox--statistics"),statisticsAdditionalCheckbox=SETTINGS.querySelector(".settings__checkbox--additional"),statisticsAdditional=SETTINGS.querySelector(".settings__label--add"),statisticsHiddenCategory=STATISTICS.querySelectorAll(".statistics__category--hide");statisticsCheckbox.addEventListener("change",(function(e){e.currentTarget.checked?(STATISTICS.classList.remove("statistics--off"),statisticsAdditional.classList.remove("settings__label--hide"),statisticsAdditionalCheckbox.removeAttribute("disabled")):(STATISTICS.classList.add("statistics--off"),statisticsAdditional.classList.add("settings__label--hide"),statisticsAdditionalCheckbox.checked=!1,statisticsAdditionalCheckbox.setAttribute("disabled","disabled"))})),statisticsAdditionalCheckbox.addEventListener("change",(function(e){statisticsHiddenCategory.forEach((e=>{e.classList.remove("statistics__category--hide")}))}));let deepFlag="main";const deepCheckbox=SETTINGS.querySelector(".settings__checkbox--deep");deepCheckbox.addEventListener("change",(function(e){deepFlag=e.currentTarget.checked?"deep":"main",setVideo()}));const line=CONTROLS.querySelector(".control__line"),lineCheckbox=SETTINGS.querySelector(".settings__checkbox--line");lineCheckbox.addEventListener("change",(function(e){e.currentTarget.checked?line.classList.remove("control__line--hide"):line.classList.add("control__line--hide")}));const scaleCheckbox=SETTINGS.querySelector(".settings__checkbox--scale");function startVideo(){let e=VIDEO.src;""===e||e.includes("undefined")?(openButton.focus(),openButton.classList.add("header__menu--error"),setTimeout((()=>{openButton.classList.remove("header__menu--error")}),2e3)):e&&VIDEO.readyState>=VIDEO.HAVE_CURRENT_DATA&&(openButton.classList.remove("header__menu--error"),STARTBUTTON.classList.add("video__start--hide"),CONTROLS.classList.remove("control--off","control--hide"),VIDEO.play(),stayFocus(),getStatistics())}let videoWidth,videoHeight,videoFormat,videoDuration,videoBuffer,videoCurrentTime;STARTBUTTON.addEventListener("click",startVideo);const statisticsClientTime=STATISTICS.querySelector(".statistics__time"),statisticsEndTime=STATISTICS.querySelector(".statistics__end"),statisticsResolution=STATISTICS.querySelector(".statistics__resolution"),statisticsUFH=document.querySelector(".statistics__ufh"),statisticsFormat=STATISTICS.querySelector(".statistics__format"),statisticsDuration=STATISTICS.querySelector(".statistics__duration"),statisticsBuffer=STATISTICS.querySelector(".statistics__buffer");function getStatistics(){STATISTICS.classList.remove("statistics--hide"),videoFormat=FILETYPE||VIDEO.src.split(".").pop(),videoWidth=VIDEO.videoWidth,videoHeight=VIDEO.videoHeight,videoDuration=Math.round(VIDEO.duration),VIDEORANGE.setAttribute("max",videoDuration),setStatistics()}function getTime(){const e=new Date,t=e.getHours(),o=e.getMinutes();statisticsClientTime.innerHTML=t+":"+o}function getEndTime(){const e=new Date;e.setSeconds(e.getSeconds()+videoDuration);const t=e.getHours(),o=e.getMinutes();statisticsEndTime.innerHTML=t+":"+o}function setStatistics(){statisticsResolution.innerHTML=videoWidth+"x"+videoHeight,statisticsFormat.innerHTML=videoFormat,statisticsDuration.innerHTML=videoDuration,videoWidth>=3840?statisticsUFH.classList.remove("statistics--off"):statisticsUFH.classList.add("statistics--off")}const tabButtons=SETTINGS.querySelectorAll(".settings__button"),tabs=SETTINGS.querySelectorAll(".settings__tab");function updateSettingsHeight(){const e=SETTINGS.querySelector(".settings__control").clientHeight,t=SETTINGS.querySelector(".settings__wrapper"),o=t.clientHeight,s=document.querySelector(".settings__tab--active"),i=s.clientHeight;BODY.clientWidth<1440&&(t.style.height=`calc(100vh - ${e}px - 61px)`,t.style.margin="0",i>o&&(s.classList.add("settings__tab--relative"),t.style.height=i+"px",t.style.margin="15px 0 40px 0"))}let progressInterval,playbackQuality;function startProgress(){progressInterval=setTimeout(updateProgress,1e3)}function updateProgress(){videoBuffer=Math.round(VIDEO.buffered.end(0)),videoCurrentTime=Math.round(VIDEO.currentTime),VIDEORANGE.value=videoCurrentTime,statisticsBuffer.innerHTML=videoBuffer;let e=formatTime(videoCurrentTime),t=formatTime(videoDuration-videoCurrentTime);videoPassed.innerHTML=e,videoLeft.innerHTML=t,startProgress(),getTime(),getEndTime(),extraLine()}function stopProgress(){clearTimeout(progressInterval)}function stayFocus(){VIDEO.paused?VIDEO.blur():VIDEO.focus()}tabButtons.forEach((e=>{e.addEventListener("click",(()=>{tabButtons.forEach((e=>e.classList.remove("settings__button--active"))),tabs.forEach((e=>{e.classList.remove("settings__tab--active"),e.classList.remove("settings__tab--relative"),e.removeAttribute("tabIndex")}));const t=e.getAttribute("data-tab");e.classList.add("settings__button--active"),document.querySelector(`.settings__tab[data-tab="${t}"]`).classList.add("settings__tab--active"),document.querySelector(`.settings__tab[data-tab="${t}"]`).setAttribute("tabIndex","0"),document.querySelector(`.settings__tab[data-tab="${t}"]`).focus(),updateSettingsHeight()}))})),updateSettingsHeight(),window.addEventListener("resize",updateSettingsHeight),VIDEO.addEventListener("play",startProgress),VIDEO.addEventListener("pause",stopProgress),VIDEO.addEventListener("ended",stopProgress),VIDEO.addEventListener("blur",stayFocus);const videoPassed=CONTROLS.querySelector(".control__time--passed"),videoLeft=CONTROLS.querySelector(".control__time--left");function resetDuration(){VIDEORANGE.value="0",videoPassed.innerHTML=formatTime(0),videoLeft.innerHTML=formatTime(0)}function formatTime(e){let t=Math.floor(e/3600),o=Math.floor((e-3600*t)/60),s=Math.floor(e-3600*t-60*o);return t=t<10?"0"+t:t,o=o<10?"0"+o:o,s=s<10?"0"+s:s,t+":"+o+":"+s}function waitingVideo(){WRAPPER.classList.add("video__wrapper--waiting")}function playingVideo(){WRAPPER.classList.remove("video__wrapper--waiting")}function endVideo(){resetVideo(),VIDEO.blur()}function errorVideo(){WRAPPER.classList.add("video__wrapper--error"),errorText.innerHTML="Помилка відео",showError()}function removeErrorVideo(){WRAPPER.classList.remove("video__wrapper--error")}function pauseAnimation(){WRAPPER.classList.add("video__wrapper--pause")}function removePauseAnimation(){WRAPPER.classList.remove("video__wrapper--pause")}function movingVideo(e){if(scaleCheckbox.checked){let t=-20*-(e.pageX/window.innerWidth-.5),o=-20*(e.pageY/window.innerHeight-.5),s=VIDEO.getBoundingClientRect(),i=e.clientX-s.left,n=e.clientY-s.top;i>=0&&i<s.width&&n>=0&&n<s.height||(WRAPPER.style.transform="perspective(1000px) rotateY("+t+"deg) rotateX("+o+"deg) scaleZ(2)")}else WRAPPER.style.transform="none"}VIDEO.addEventListener("waiting",waitingVideo),VIDEO.addEventListener("playing",playingVideo),VIDEO.addEventListener("ended",endVideo),VIDEO.addEventListener("error",errorVideo),VIDEO.addEventListener("loadeddata",removeErrorVideo),VIDEO.addEventListener("pause",pauseAnimation),VIDEO.addEventListener("playing",removePauseAnimation),VIDEO.addEventListener("ended",removePauseAnimation),BODY.addEventListener("mousemove",movingVideo);